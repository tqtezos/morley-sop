<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE UndecidableSuperClasses #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- | Primitives supplying entrypoints declarations and lookup.</span><span>
</span><a name="line-4"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lorentz.EntryPoints.Core</span><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Lorentz.EntryPoints.Helpers.html#CanHaveEntryPoints"><span class="hs-identifier hs-type">CanHaveEntryPoints</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointsDerivation"><span class="hs-identifier hs-type">EntryPointsDerivation</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpConstructionRes"><span class="hs-identifier hs-type">EpConstructionRes</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier hs-type">EpCallingDesc</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpCallingStep"><span class="hs-identifier hs-type">EpCallingStep</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#RequireAllUniqueEntryPoints"><span class="hs-identifier hs-type">RequireAllUniqueEntryPoints</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ParameterHasEntryPoints"><span class="hs-identifier hs-type">ParameterHasEntryPoints</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#GetParameterEpDerivation"><span class="hs-identifier hs-type">GetParameterEpDerivation</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#pepNotes"><span class="hs-identifier hs-var">pepNotes</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#pepCall"><span class="hs-identifier hs-var">pepCall</span></a><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#pepDescs"><span class="hs-identifier hs-var">pepDescs</span></a><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#pepDescsWithDef"><span class="hs-identifier hs-var">pepDescsWithDef</span></a><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#AllParameterEntryPoints"><span class="hs-identifier hs-type">AllParameterEntryPoints</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#LookupParameterEntryPoint"><span class="hs-identifier hs-type">LookupParameterEntryPoint</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointsToNotes"><span class="hs-identifier hs-var">parameterEntryPointsToNotes</span></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#GetEntryPointArg"><span class="hs-identifier hs-type">GetEntryPointArg</span></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointCall"><span class="hs-identifier hs-var">parameterEntryPointCall</span></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#GetDefaultEntryPointArg"><span class="hs-identifier hs-type">GetDefaultEntryPointArg</span></a><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointCallDefault"><span class="hs-identifier hs-var">parameterEntryPointCallDefault</span></a><span>
</span><a name="line-25"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ForbidExplicitDefaultEntryPoint"><span class="hs-identifier hs-type">ForbidExplicitDefaultEntryPoint</span></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#NoExplicitDefaultEntryPoint"><span class="hs-identifier hs-type">NoExplicitDefaultEntryPoint</span></a><span>
</span><a name="line-27"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#sepcCallRootChecked"><span class="hs-identifier hs-var">sepcCallRootChecked</span></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointRef"><span class="hs-identifier hs-type">EntryPointRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#NiceEntryPointName"><span class="hs-identifier hs-type">NiceEntryPointName</span></a><span>
</span><a name="line-30"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#eprName"><span class="hs-identifier hs-var">eprName</span></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#GetEntryPointArgCustom"><span class="hs-identifier hs-type">GetEntryPointArgCustom</span></a><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#TrustEpName"><span class="hs-identifier hs-type">TrustEpName</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#HasEntryPointArg"><span class="hs-identifier hs-type">HasEntryPointArg</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#HasDefEntryPointArg"><span class="hs-identifier hs-type">HasDefEntryPointArg</span></a><span>
</span><a name="line-35"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#HasEntryPointOfType"><span class="hs-identifier hs-type">HasEntryPointOfType</span></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ParameterContainsEntryPoints"><span class="hs-identifier hs-type">ParameterContainsEntryPoints</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointCallCustom"><span class="hs-identifier hs-var">parameterEntryPointCallCustom</span></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpdNone"><span class="hs-identifier hs-type">EpdNone</span></a><span>
</span><a name="line-39"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#%3A%3E"><span class="hs-operator hs-type">:&gt;</span></a><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span>    </span><span class="hs-comment">-- * Internals</span><span>
</span><a name="line-42"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#RequireAllUniqueEntryPoints%27"><span class="hs-identifier hs-type">RequireAllUniqueEntryPoints'</span></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Constraint</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dict</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">\\</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Kind</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Kind</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Typeable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeRep</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Vinyl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Rec</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Fcf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eval</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Exp</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Fcf</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Fcf.Utils</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Fcf</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Fmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pretty</span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Michelson.Typed</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Label</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.Type</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util.TypeLits</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.Constraints.Scopes.html"><span class="hs-identifier">Lorentz.Constraints.Scopes</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.EntryPoints.Helpers.html"><span class="hs-identifier">Lorentz.EntryPoints.Helpers</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="Lorentz.TypeAnns.html"><span class="hs-identifier">Lorentz.TypeAnns</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.TypeAnns.html#HasTypeAnn"><span class="hs-identifier hs-type">HasTypeAnn</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.TypeAnns.html#getTypeAnn"><span class="hs-identifier hs-var">getTypeAnn</span></a><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">-- | Defines a generalized way to declare entrypoints for various parameter types.</span><span>
</span><a name="line-64"></a><span class="hs-comment">--</span><span>
</span><a name="line-65"></a><span class="hs-comment">-- When defining instances of this typeclass, set concrete @deriv@ argument</span><span>
</span><a name="line-66"></a><span class="hs-comment">-- and leave variable @cp@ argument.</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- Also keep in mind, that in presence of explicit default entrypoint, all other</span><span>
</span><a name="line-68"></a><span class="hs-comment">-- 'Or' arms should be callable, though you can put this burden on user if very</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- necessary.</span><span>
</span><a name="line-70"></a><span class="hs-comment">--</span><span>
</span><a name="line-71"></a><span class="hs-comment">-- Methods of this typeclass aim to better type-safety when making up an</span><span>
</span><a name="line-72"></a><span class="hs-comment">-- implementation and they may be not too convenient to use; users should</span><span>
</span><a name="line-73"></a><span class="hs-comment">-- exploit their counterparts.</span><span>
</span><a name="line-74"></a><span class="hs-keyword">class</span><span> </span><a name="EntryPointsDerivation"><a href="Lorentz.EntryPoints.Core.html#EntryPointsDerivation"><span class="hs-identifier">EntryPointsDerivation</span></a></a><span> </span><a name="local-6989586621679297764"><a href="#local-6989586621679297764"><span class="hs-identifier">deriv</span></a></a><span> </span><a name="local-6989586621679297765"><a href="#local-6989586621679297765"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-75"></a><span>  </span><span class="hs-comment">-- | Name and argument of each entrypoint.</span><span>
</span><a name="line-76"></a><span>  </span><span class="hs-comment">-- This may include intermediate ones, even root if necessary.</span><span>
</span><a name="line-77"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-comment">-- Touching this type family is costly (@O(N^2)@), don't use it often.</span><span>
</span><a name="line-79"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-80"></a><span>  </span><span class="hs-comment">-- Note [order of entrypoints children]:</span><span>
</span><a name="line-81"></a><span>  </span><span class="hs-comment">-- If this contains entrypoints referring to indermediate nodes (not leaves)</span><span>
</span><a name="line-82"></a><span>  </span><span class="hs-comment">-- in @or@ tree, then each such entrypoint should be mentioned eariler than</span><span>
</span><a name="line-83"></a><span>  </span><span class="hs-comment">-- all of its children.</span><span>
</span><a name="line-84"></a><span>  </span><span class="hs-keyword">type</span><span> </span><a name="EpdAllEntryPoints"><a href="Lorentz.EntryPoints.Core.html#EpdAllEntryPoints"><span class="hs-identifier">EpdAllEntryPoints</span></a></a><span> </span><a name="local-6989586621679297764"><a href="#local-6989586621679297764"><span class="hs-identifier">deriv</span></a></a><span> </span><a name="local-6989586621679297765"><a href="#local-6989586621679297765"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>  </span><span class="hs-comment">-- | Get entrypoint argument by name.</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-keyword">type</span><span> </span><a name="EpdLookupEntryPoint"><a href="Lorentz.EntryPoints.Core.html#EpdLookupEntryPoint"><span class="hs-identifier">EpdLookupEntryPoint</span></a></a><span> </span><a name="local-6989586621679297764"><a href="#local-6989586621679297764"><span class="hs-identifier">deriv</span></a></a><span> </span><a name="local-6989586621679297765"><a href="#local-6989586621679297765"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Exp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>  </span><span class="hs-comment">-- | Construct parameter annotations corresponding to expected entrypoints set.</span><span>
</span><a name="line-90"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-91"></a><span>  </span><span class="hs-comment">-- This method is implementation detail, for actual notes construction</span><span>
</span><a name="line-92"></a><span>  </span><span class="hs-comment">-- use 'parameterEntryPointsToNotes'.</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-94"></a><span>  </span><span class="hs-comment">-- TODO [#35]: Should also return field annotation</span><span>
</span><a name="line-95"></a><span>  </span><a name="epdNotes"><a href="Lorentz.EntryPoints.Core.html#epdNotes"><span class="hs-identifier">epdNotes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Notes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679297765"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>  </span><span class="hs-comment">-- | Construct entrypoint caller.</span><span>
</span><a name="line-98"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-99"></a><span>  </span><span class="hs-comment">-- This does not treat calls to default entrypoint in a special way.</span><span>
</span><a name="line-100"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-101"></a><span>  </span><span class="hs-comment">-- This method is implementation detail, for actual entrypoint lookup</span><span>
</span><a name="line-102"></a><span>  </span><span class="hs-comment">-- use 'parameterEntryPointCall'.</span><span>
</span><a name="line-103"></a><span>  </span><a name="epdCall"><a href="Lorentz.EntryPoints.Core.html#epdCall"><span class="hs-identifier">epdCall</span></a></a><span>
</span><a name="line-104"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ParameterScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679297765"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Label</span><span> </span><a href="#local-6989586621679297766"><span class="hs-identifier hs-type">name</span></a><span>
</span><a name="line-106"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpConstructionRes"><span class="hs-identifier hs-type">EpConstructionRes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679297765"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eval</span><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#EpdLookupEntryPoint"><span class="hs-identifier hs-type">EpdLookupEntryPoint</span></a><span> </span><a href="#local-6989586621679297764"><span class="hs-identifier hs-type">deriv</span></a><span> </span><a href="#local-6989586621679297765"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="#local-6989586621679297766"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span>  </span><span class="hs-comment">-- | Description of how each of the entrypoints is constructed.</span><span>
</span><a name="line-109"></a><span>  </span><a name="epdDescs"><a href="Lorentz.EntryPoints.Core.html#epdDescs"><span class="hs-identifier">epdDescs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Rec</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier hs-type">EpCallingDesc</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#EpdAllEntryPoints"><span class="hs-identifier hs-type">EpdAllEntryPoints</span></a><span> </span><a href="#local-6989586621679297764"><span class="hs-identifier hs-type">deriv</span></a><span> </span><a href="#local-6989586621679297765"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-keyword">type</span><span> </span><a name="RequireAllUniqueEntryPoints%27"><a href="Lorentz.EntryPoints.Core.html#RequireAllUniqueEntryPoints%27"><span class="hs-identifier">RequireAllUniqueEntryPoints'</span></a></a><span> </span><a name="local-6989586621679297762"><a href="#local-6989586621679297762"><span class="hs-identifier">deriv</span></a></a><span> </span><a name="local-6989586621679297763"><a href="#local-6989586621679297763"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-112"></a><span>  </span><span class="hs-identifier hs-type">RequireAllUnique</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-string">&quot;entrypoint name&quot;</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eval</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fcf.Map</span><span> </span><span class="hs-identifier hs-type">Fcf.Fst</span><span> </span><span class="hs-operator">$</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpdAllEntryPoints"><span class="hs-identifier hs-type">EpdAllEntryPoints</span></a><span> </span><a href="#local-6989586621679297762"><span class="hs-identifier hs-type">deriv</span></a><span> </span><a href="#local-6989586621679297763"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">-- | Ensure that all declared entrypoints are unique.</span><span>
</span><a name="line-117"></a><span class="hs-keyword">type</span><span> </span><a name="RequireAllUniqueEntryPoints"><a href="Lorentz.EntryPoints.Core.html#RequireAllUniqueEntryPoints"><span class="hs-identifier">RequireAllUniqueEntryPoints</span></a></a><span> </span><a name="local-6989586621679297761"><a href="#local-6989586621679297761"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-118"></a><span>  </span><a href="Lorentz.EntryPoints.Core.html#RequireAllUniqueEntryPoints%27"><span class="hs-identifier hs-type">RequireAllUniqueEntryPoints'</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ParameterEntryPointsDerivation"><span class="hs-identifier hs-type">ParameterEntryPointsDerivation</span></a><span> </span><a href="#local-6989586621679297761"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679297761"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">-- | Result of entrypoint lookup at term level.</span><span>
</span><a name="line-121"></a><span class="hs-keyword">data</span><span> </span><a name="EpConstructionRes"><a href="Lorentz.EntryPoints.Core.html#EpConstructionRes"><span class="hs-identifier">EpConstructionRes</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679297756"><a href="#local-6989586621679297756"><span class="hs-identifier">param</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">T</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679297757"><a href="#local-6989586621679297757"><span class="hs-identifier">marg</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-122"></a><span>  </span><a name="EpConstructed"><a href="Lorentz.EntryPoints.Core.html#EpConstructed"><span class="hs-identifier">EpConstructed</span></a></a><span>
</span><a name="line-123"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ParameterScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679297758"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">EpLiftSequence</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679297758"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679297759"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpConstructionRes"><span class="hs-identifier hs-type">EpConstructionRes</span></a><span> </span><a href="#local-6989586621679297759"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Just</span><span> </span><a href="#local-6989586621679297758"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>  </span><a name="EpConstructionFailed"><a href="Lorentz.EntryPoints.Core.html#EpConstructionFailed"><span class="hs-identifier">EpConstructionFailed</span></a></a><span>
</span><a name="line-126"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpConstructionRes"><span class="hs-identifier hs-type">EpConstructionRes</span></a><span> </span><a href="#local-6989586621679297760"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">-- | How one of the entrypoints is called.</span><span>
</span><a name="line-129"></a><span class="hs-comment">--</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- Type arguments are name of the constructor which eventually gave</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- name to the entrypoint and this entrypoint's argument.</span><span>
</span><a name="line-132"></a><span class="hs-keyword">data</span><span> </span><a name="EpCallingDesc"><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier">EpCallingDesc</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679297753"><a href="#local-6989586621679297753"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-133"></a><span>  </span><a name="EpCallingDesc"><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier">EpCallingDesc</span></a></a><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="epcdArg"><a href="Lorentz.EntryPoints.Core.html#epcdArg"><span class="hs-identifier">epcdArg</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679297754"><span class="hs-identifier hs-type">arg</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span>
</span><a name="line-135"></a><span>      </span><span class="hs-comment">-- ^ Entrypoint argument type.</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="epcdEntrypoint"><a href="Lorentz.EntryPoints.Core.html#epcdEntrypoint"><span class="hs-identifier">epcdEntrypoint</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">EpName</span><span>
</span><a name="line-137"></a><span>      </span><span class="hs-comment">-- ^ Name of assigned entrypoint.</span><span>
</span><a name="line-138"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="epcdSteps"><a href="Lorentz.EntryPoints.Core.html#epcdSteps"><span class="hs-identifier">epcdSteps</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.EntryPoints.Core.html#EpCallingStep"><span class="hs-identifier hs-type">EpCallingStep</span></a><span class="hs-special">]</span><span>
</span><a name="line-139"></a><span>      </span><span class="hs-comment">-- ^ If we emulated entrypoints calling via just wrapping an argument into</span><span>
</span><a name="line-140"></a><span>      </span><span class="hs-comment">-- constructors until getting the full parameter, how would it look like.</span><span>
</span><a name="line-141"></a><span>      </span><span class="hs-comment">-- Steps are enlisted in reversed order - top-level constructors go last.</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier hs-type">EpCallingDesc</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><a href="#local-6989586621679297755"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679297754"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier hs-type">EpCallingDesc</span></a><span> </span><a href="#local-6989586621679298104"><span class="hs-identifier hs-type">info</span></a><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-keyword">data</span><span> </span><a name="EpCallingStep"><a href="Lorentz.EntryPoints.Core.html#EpCallingStep"><span class="hs-identifier">EpCallingStep</span></a></a><span>
</span><a name="line-147"></a><span>  </span><span class="hs-comment">-- | Wrap into constructor with given name.</span><span>
</span><a name="line-148"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="EpsWrapIn"><a href="Lorentz.EntryPoints.Core.html#EpsWrapIn"><span class="hs-identifier">EpsWrapIn</span></a></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-149"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-comment">-- | Which entrypoints given parameter declares.</span><span>
</span><a name="line-152"></a><span class="hs-comment">--</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- Note that usually this function should not be used as constraint, use</span><span>
</span><a name="line-154"></a><span class="hs-comment">-- 'ParameterDeclaresEntryPoints' for this purpose.</span><span>
</span><a name="line-155"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointsDerivation"><span class="hs-identifier hs-type">EntryPointsDerivation</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ParameterEntryPointsDerivation"><span class="hs-identifier hs-type">ParameterEntryPointsDerivation</span></a><span> </span><a href="#local-6989586621679296945"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296945"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-156"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#RequireAllUniqueEntryPoints"><span class="hs-identifier hs-type">RequireAllUniqueEntryPoints</span></a><span> </span><a href="#local-6989586621679296945"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-157"></a><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-158"></a><span>      </span><a name="ParameterHasEntryPoints"><a href="Lorentz.EntryPoints.Core.html#ParameterHasEntryPoints"><span class="hs-identifier">ParameterHasEntryPoints</span></a></a><span> </span><a name="local-6989586621679296945"><a href="#local-6989586621679296945"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-159"></a><span>  </span><span class="hs-keyword">type</span><span> </span><a name="ParameterEntryPointsDerivation"><a href="Lorentz.EntryPoints.Core.html#ParameterEntryPointsDerivation"><span class="hs-identifier">ParameterEntryPointsDerivation</span></a></a><span> </span><a name="local-6989586621679296945"><a href="#local-6989586621679296945"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- | Parameter declares some entrypoints.</span><span>
</span><a name="line-162"></a><span class="hs-comment">--</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- This is a version of 'ParameterHasEntryPoints' which we actually use in</span><span>
</span><a name="line-164"></a><span class="hs-comment">-- constraints. When given type is a sum type or newtype, we refer to</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- 'ParameterHasEntryPoints' instance, otherwise this instance is not</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- necessary.</span><span>
</span><a name="line-167"></a><span class="hs-keyword">type</span><span> </span><a name="ParameterDeclaresEntryPoints"><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier">ParameterDeclaresEntryPoints</span></a></a><span> </span><a name="local-6989586621679296944"><a href="#local-6989586621679296944"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-168"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">If</span><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Helpers.html#CanHaveEntryPoints"><span class="hs-identifier hs-type">CanHaveEntryPoints</span></a><span> </span><a href="#local-6989586621679296944"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>     </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ParameterHasEntryPoints"><span class="hs-identifier hs-type">ParameterHasEntryPoints</span></a><span> </span><a href="#local-6989586621679296944"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>     </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.Constraints.Scopes.html#NiceParameter"><span class="hs-identifier hs-type">NiceParameter</span></a><span> </span><a href="#local-6989586621679296944"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-172"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointsDerivation"><span class="hs-identifier hs-type">EntryPointsDerivation</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#GetParameterEpDerivation"><span class="hs-identifier hs-type">GetParameterEpDerivation</span></a><span> </span><a href="#local-6989586621679296944"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296944"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-173"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span class="hs-comment">-- | Version of 'ParameterEntryPointsDerivation' which we actually use in</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- function signatures. When given type is sum type or newtype, we refer to</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- 'ParameterEntryPointsDerivation', otherwise we suppose that no entrypoints</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- are declared.</span><span>
</span><a name="line-179"></a><span class="hs-keyword">type</span><span> </span><a name="GetParameterEpDerivation"><a href="Lorentz.EntryPoints.Core.html#GetParameterEpDerivation"><span class="hs-identifier">GetParameterEpDerivation</span></a></a><span> </span><a name="local-6989586621679296943"><a href="#local-6989586621679296943"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-180"></a><span>  </span><span class="hs-identifier hs-type">If</span><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Helpers.html#CanHaveEntryPoints"><span class="hs-identifier hs-type">CanHaveEntryPoints</span></a><span> </span><a href="#local-6989586621679296943"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>     </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ParameterEntryPointsDerivation"><span class="hs-identifier hs-type">ParameterEntryPointsDerivation</span></a><span> </span><a href="#local-6989586621679296943"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>     </span><a href="Lorentz.EntryPoints.Core.html#EpdNone"><span class="hs-identifier hs-type">EpdNone</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-comment">-- | Version of 'epdNotes' which we actually use in code.</span><span>
</span><a name="line-185"></a><span class="hs-comment">-- It hides derivations stuff inside, and treats primitive types specially</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- like 'GetParameterEpDerivation' does.</span><span>
</span><a name="line-187"></a><span class="hs-identifier">pepNotes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297787"><a href="#local-6989586621679297787"><span class="hs-identifier">cp</span></a></a><span class="hs-operator">.</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679297787"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Notes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679297787"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-188"></a><a name="pepNotes"><a href="Lorentz.EntryPoints.Core.html#pepNotes"><span class="hs-identifier">pepNotes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.EntryPoints.Core.html#epdNotes"><span class="hs-identifier hs-var">epdNotes</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#GetParameterEpDerivation"><span class="hs-identifier hs-type">GetParameterEpDerivation</span></a><span> </span><a href="#local-6989586621679297787"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297787"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">-- | Version of 'epdCall' which we actually use in code.</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- It hides derivations stuff inside, and treats primitive types specially</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- like 'GetParameterEpDerivation' does.</span><span>
</span><a name="line-193"></a><span class="hs-identifier">pepCall</span><span>
</span><a name="line-194"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297785"><a href="#local-6989586621679297785"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679297786"><a href="#local-6989586621679297786"><span class="hs-identifier">name</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-195"></a><span>     </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679297785"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ParameterScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679297785"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Label</span><span> </span><a href="#local-6989586621679297786"><span class="hs-identifier hs-type">name</span></a><span>
</span><a name="line-197"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpConstructionRes"><span class="hs-identifier hs-type">EpConstructionRes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679297785"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eval</span><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#LookupParameterEntryPoint"><span class="hs-identifier hs-type">LookupParameterEntryPoint</span></a><span> </span><a href="#local-6989586621679297785"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="#local-6989586621679297786"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-198"></a><a name="pepCall"><a href="Lorentz.EntryPoints.Core.html#pepCall"><span class="hs-identifier">pepCall</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.EntryPoints.Core.html#epdCall"><span class="hs-identifier hs-var">epdCall</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#GetParameterEpDerivation"><span class="hs-identifier hs-type">GetParameterEpDerivation</span></a><span> </span><a href="#local-6989586621679297785"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297785"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- | Version of 'epdDescs' which we actually use in code.</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- It hides derivations stuff inside, and treats primitive types specially</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- like 'GetParameterEpDerivation' does.</span><span>
</span><a name="line-203"></a><span class="hs-identifier">pepDescs</span><span>
</span><a name="line-204"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297784"><a href="#local-6989586621679297784"><span class="hs-identifier">cp</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-205"></a><span>     </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679297784"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Rec</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier hs-type">EpCallingDesc</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#AllParameterEntryPoints"><span class="hs-identifier hs-type">AllParameterEntryPoints</span></a><span> </span><a href="#local-6989586621679297784"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-207"></a><a name="pepDescs"><a href="Lorentz.EntryPoints.Core.html#pepDescs"><span class="hs-identifier">pepDescs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.EntryPoints.Core.html#epdDescs"><span class="hs-identifier hs-var">epdDescs</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#GetParameterEpDerivation"><span class="hs-identifier hs-type">GetParameterEpDerivation</span></a><span> </span><a href="#local-6989586621679297784"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297784"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-comment">-- | Descriptions of how each of the entrypoints is constructed.</span><span>
</span><a name="line-210"></a><span class="hs-comment">--</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- Similar to 'pepDescs', but includes default entrypoint disregard whether it is</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- explicit or not, while 'pepDescs' includes it only if it is explicit.</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- Also this returns list, not 'Rec', for simplicity.</span><span>
</span><a name="line-214"></a><span class="hs-comment">--</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- Note that [order of entrypoints children] property still holds here.</span><span>
</span><a name="line-216"></a><span class="hs-identifier">pepDescsWithDef</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297783"><a href="#local-6989586621679297783"><span class="hs-identifier">cp</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-218"></a><span>     </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679297783"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Some1</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier hs-type">EpCallingDesc</span></a><span class="hs-special">]</span><span>
</span><a name="line-220"></a><a name="pepDescsWithDef"><a href="Lorentz.EntryPoints.Core.html#pepDescsWithDef"><span class="hs-identifier">pepDescsWithDef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679297788"><span class="hs-identifier hs-var">addDefaultIfImplicit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lorentz.EntryPoints.Core.html#pepDescs"><span class="hs-identifier hs-var">pepDescs</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297783"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-221"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-222"></a><span>    </span><a name="local-6989586621679297788"><a href="#local-6989586621679297788"><span class="hs-identifier">addDefaultIfImplicit</span></a></a><span> </span><a name="local-6989586621679297789"><a href="#local-6989586621679297789"><span class="hs-identifier">descsRec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-223"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679297790"><a href="#local-6989586621679297790"><span class="hs-identifier">descs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">recordToSomeList</span><span> </span><a href="#local-6989586621679297789"><span class="hs-identifier hs-var">descsRec</span></a><span>
</span><a name="line-224"></a><span>          </span><a name="local-6989586621679297791"><a href="#local-6989586621679297791"><span class="hs-identifier">hasDef</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-225"></a><span>            </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Some1</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier hs-var">EpCallingDesc</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679297793"><span class="hs-identifier hs-var">epcdEntrypoint</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">DefEpName</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679297790"><span class="hs-identifier hs-var">descs</span></a><span>
</span><a name="line-226"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679297791"><span class="hs-identifier hs-var">hasDef</span></a><span>
</span><a name="line-227"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679297790"><span class="hs-identifier hs-var">descs</span></a><span>
</span><a name="line-228"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Some1</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpCallingDesc"><span class="hs-identifier hs-var">EpCallingDesc</span></a><span>
</span><a name="line-229"></a><span>              </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">epcdArg</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297783"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-230"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">epcdEntrypoint</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">DefEpName</span><span>
</span><a name="line-231"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">epcdSteps</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-232"></a><span>              </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679297790"><span class="hs-identifier hs-var">descs</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- Derived methods and type families</span><span>
</span><a name="line-235"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-comment">-- | Get all entrypoints declared for parameter.</span><span>
</span><a name="line-238"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="AllParameterEntryPoints"><a href="Lorentz.EntryPoints.Core.html#AllParameterEntryPoints"><span class="hs-identifier">AllParameterEntryPoints</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679296941"><a href="#local-6989586621679296941"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-240"></a><span>  </span><span class="hs-identifier">AllParameterEntryPoints</span><span> </span><a href="#local-6989586621679296942"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-241"></a><span>    </span><a href="Lorentz.EntryPoints.Core.html#EpdAllEntryPoints"><span class="hs-identifier hs-type">EpdAllEntryPoints</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#GetParameterEpDerivation"><span class="hs-identifier hs-type">GetParameterEpDerivation</span></a><span> </span><a href="#local-6989586621679296942"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296942"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-comment">-- | Lookup for entrypoint type by name.</span><span>
</span><a name="line-244"></a><span class="hs-comment">--</span><span>
</span><a name="line-245"></a><span class="hs-comment">-- Does not treat default entrypoints in a special way.</span><span>
</span><a name="line-246"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="LookupParameterEntryPoint"><a href="Lorentz.EntryPoints.Core.html#LookupParameterEntryPoint"><span class="hs-identifier">LookupParameterEntryPoint</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679296939"><a href="#local-6989586621679296939"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Exp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-248"></a><span>  </span><span class="hs-identifier">LookupParameterEntryPoint</span><span> </span><a href="#local-6989586621679296940"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-249"></a><span>    </span><a href="Lorentz.EntryPoints.Core.html#EpdLookupEntryPoint"><span class="hs-identifier hs-type">EpdLookupEntryPoint</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#GetParameterEpDerivation"><span class="hs-identifier hs-type">GetParameterEpDerivation</span></a><span> </span><a href="#local-6989586621679296940"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679296940"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">-- | Derive annotations for given parameter.</span><span>
</span><a name="line-252"></a><span class="hs-identifier">parameterEntryPointsToNotes</span><span>
</span><a name="line-253"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297782"><a href="#local-6989586621679297782"><span class="hs-identifier">cp</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-254"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679297782"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679297782"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ParamNotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679297782"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><a name="parameterEntryPointsToNotes"><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointsToNotes"><span class="hs-identifier">parameterEntryPointsToNotes</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-257"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679297795"><a href="#local-6989586621679297795"><span class="hs-identifier">notes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.EntryPoints.Core.html#pepNotes"><span class="hs-identifier hs-var">pepNotes</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297782"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-258"></a><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">mkParamNotes</span><span> </span><a href="#local-6989586621679297795"><span class="hs-identifier hs-var">notes</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-259"></a><span>       </span><span class="hs-comment">-- Normally this should be valid because</span><span>
</span><a name="line-260"></a><span>       </span><span class="hs-comment">-- 1. Constraint in superclass of 'ParameterHasEntryPoints' ensures that</span><span>
</span><a name="line-261"></a><span>       </span><span class="hs-comment">-- no entrypoint is duplicated.</span><span>
</span><a name="line-262"></a><span>       </span><span class="hs-comment">-- 2. Each entrypoint is callable by laws of 'EntryPointsDerivation'.</span><span>
</span><a name="line-263"></a><span>       </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679297796"><a href="#local-6989586621679297796"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679297796"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-264"></a><span>       </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679297797"><a href="#local-6989586621679297797"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mconcat</span><span>
</span><a name="line-265"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;Lorentz unexpectedly compiled into contract with \
          \illegal parameter declaration.\n&quot;</span><span>
</span><a name="line-267"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Parameter: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeRep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297782"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span>
</span><a name="line-268"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Derived annotations: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679297795"><span class="hs-identifier hs-var">notes</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span>
</span><a name="line-269"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Failure reason: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">pretty</span><span> </span><a href="#local-6989586621679297797"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-270"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-comment">-- | Prepare call to given entrypoint.</span><span>
</span><a name="line-273"></a><span class="hs-comment">--</span><span>
</span><a name="line-274"></a><span class="hs-comment">-- This does not treat calls to default entrypoint in a special way.</span><span>
</span><a name="line-275"></a><span class="hs-comment">-- To call default entrypoint properly use 'parameterEntryPointCallDefault'.</span><span>
</span><a name="line-276"></a><span class="hs-identifier">parameterEntryPointCall</span><span>
</span><a name="line-277"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297780"><a href="#local-6989586621679297780"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679297781"><a href="#local-6989586621679297781"><span class="hs-identifier">name</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-278"></a><span>     </span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679297780"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-279"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Label</span><span> </span><a href="#local-6989586621679297781"><span class="hs-identifier hs-type">name</span></a><span>
</span><a name="line-280"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EntryPointCall</span><span> </span><a href="#local-6989586621679297780"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#GetEntryPointArg"><span class="hs-identifier hs-type">GetEntryPointArg</span></a><span> </span><a href="#local-6989586621679297780"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="#local-6989586621679297781"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-281"></a><a name="parameterEntryPointCall"><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointCall"><span class="hs-identifier">parameterEntryPointCall</span></a></a><span> </span><span class="hs-keyword">label</span><span class="hs-glyph">@</span><span class="hs-identifier hs-var">Label</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-282"></a><span>  </span><span class="hs-identifier hs-var">withDict</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Constraints.Scopes.html#niceParameterEvi"><span class="hs-identifier hs-var">niceParameterEvi</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297780"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-283"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Lorentz.EntryPoints.Core.html#pepCall"><span class="hs-identifier hs-var">pepCall</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297780"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-keyword">label</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-284"></a><span>    </span><a href="Lorentz.EntryPoints.Core.html#EpConstructed"><span class="hs-identifier hs-var">EpConstructed</span></a><span> </span><a name="local-6989586621679298061"><a href="#local-6989586621679298061"><span class="hs-identifier">liftSeq</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">EntryPointCall</span><span>
</span><a name="line-285"></a><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">epcName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.EntryPoints.Helpers.html#ctorNameToEp"><span class="hs-identifier hs-var">ctorNameToEp</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297781"><span class="hs-identifier hs-type">name</span></a><span>
</span><a name="line-286"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">epcParamProxy</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-287"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">epcLiftSequence</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679298061"><span class="hs-identifier hs-var">liftSeq</span></a><span>
</span><a name="line-288"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-289"></a><span>    </span><a href="Lorentz.EntryPoints.Core.html#EpConstructionFailed"><span class="hs-identifier hs-var">EpConstructionFailed</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-290"></a><span>      </span><span class="hs-comment">-- Not possible by 'GetEntryPointArg' constraint.</span><span>
</span><a name="line-291"></a><span>      </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;impossible&quot;</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">-- | Get type of entrypoint with given name, fail if not found.</span><span>
</span><a name="line-294"></a><span class="hs-keyword">type</span><span> </span><a name="GetEntryPointArg"><a href="Lorentz.EntryPoints.Core.html#GetEntryPointArg"><span class="hs-identifier">GetEntryPointArg</span></a></a><span> </span><a name="local-6989586621679296937"><a href="#local-6989586621679296937"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679296938"><a href="#local-6989586621679296938"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Eval</span><span>
</span><a name="line-295"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Fcf.LiftM2</span><span>
</span><a name="line-296"></a><span>      </span><span class="hs-identifier hs-type">Fcf.FromMaybe</span><span>
</span><a name="line-297"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fcf.TError</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;Entrypoint not found: &quot;</span><span> </span><span class="hs-special">'</span><span class="hs-operator hs-type">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">ShowType</span><span> </span><a href="#local-6989586621679296938"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span>
</span><a name="line-298"></a><span>                   </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;In contract parameter `&quot;</span><span> </span><span class="hs-special">'</span><span class="hs-operator hs-type">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">ShowType</span><span> </span><a href="#local-6989586621679296937"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;`&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-299"></a><span>      </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#LookupParameterEntryPoint"><span class="hs-identifier hs-type">LookupParameterEntryPoint</span></a><span> </span><a href="#local-6989586621679296937"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="#local-6989586621679296938"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span class="hs-keyword">type</span><span> </span><a name="DefaultEpName"><a href="Lorentz.EntryPoints.Core.html#DefaultEpName"><span class="hs-identifier">DefaultEpName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Default&quot;</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- | Call the default entrypoint.</span><span>
</span><a name="line-305"></a><span class="hs-identifier">parameterEntryPointCallDefault</span><span>
</span><a name="line-306"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297779"><a href="#local-6989586621679297779"><span class="hs-identifier">cp</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-307"></a><span>     </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679297779"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-308"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">EntryPointCall</span><span> </span><a href="#local-6989586621679297779"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#GetDefaultEntryPointArg"><span class="hs-identifier hs-type">GetDefaultEntryPointArg</span></a><span> </span><a href="#local-6989586621679297779"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-309"></a><a name="parameterEntryPointCallDefault"><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointCallDefault"><span class="hs-identifier">parameterEntryPointCallDefault</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-310"></a><span>  </span><span class="hs-identifier hs-var">withDict</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Constraints.Scopes.html#niceParameterEvi"><span class="hs-identifier hs-var">niceParameterEvi</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297779"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-311"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Lorentz.EntryPoints.Core.html#pepCall"><span class="hs-identifier hs-var">pepCall</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297779"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromLabel</span><span> </span><span class="hs-glyph">@</span><a href="Lorentz.EntryPoints.Core.html#DefaultEpName"><span class="hs-identifier hs-type">DefaultEpName</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-312"></a><span>    </span><a href="Lorentz.EntryPoints.Core.html#EpConstructed"><span class="hs-identifier hs-var">EpConstructed</span></a><span> </span><a name="local-6989586621679298100"><a href="#local-6989586621679298100"><span class="hs-identifier">liftSeq</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">EntryPointCall</span><span>
</span><a name="line-313"></a><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">epcName</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">DefEpName</span><span>
</span><a name="line-314"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">epcParamProxy</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-315"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">epcLiftSequence</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679298100"><span class="hs-identifier hs-var">liftSeq</span></a><span>
</span><a name="line-316"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-317"></a><span>    </span><a href="Lorentz.EntryPoints.Core.html#EpConstructionFailed"><span class="hs-identifier hs-var">EpConstructionFailed</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-318"></a><span>      </span><span class="hs-identifier hs-var">EntryPointCall</span><span>
</span><a name="line-319"></a><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">epcName</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">DefEpName</span><span>
</span><a name="line-320"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">epcParamProxy</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-321"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">epcLiftSequence</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EplArgHere</span><span>
</span><a name="line-322"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-comment">-- | Get type of entrypoint with given name, fail if not found.</span><span>
</span><a name="line-325"></a><span class="hs-keyword">type</span><span> </span><a name="GetDefaultEntryPointArg"><a href="Lorentz.EntryPoints.Core.html#GetDefaultEntryPointArg"><span class="hs-identifier">GetDefaultEntryPointArg</span></a></a><span> </span><a name="local-6989586621679296936"><a href="#local-6989586621679296936"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Eval</span><span>
</span><a name="line-326"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Fcf.LiftM2</span><span>
</span><a name="line-327"></a><span>      </span><span class="hs-identifier hs-type">Fcf.FromMaybe</span><span>
</span><a name="line-328"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fcf.Pure</span><span> </span><a href="#local-6989586621679296936"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>      </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#LookupParameterEntryPoint"><span class="hs-identifier hs-type">LookupParameterEntryPoint</span></a><span> </span><a href="#local-6989586621679296936"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="Lorentz.EntryPoints.Core.html#DefaultEpName"><span class="hs-identifier hs-type">DefaultEpName</span></a><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">-- | Ensure that there is no explicit &quot;default&quot; entrypoint.</span><span>
</span><a name="line-333"></a><span class="hs-keyword">type</span><span> </span><a name="ForbidExplicitDefaultEntryPoint"><a href="Lorentz.EntryPoints.Core.html#ForbidExplicitDefaultEntryPoint"><span class="hs-identifier">ForbidExplicitDefaultEntryPoint</span></a></a><span> </span><a name="local-6989586621679296935"><a href="#local-6989586621679296935"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Eval</span><span>
</span><a name="line-334"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fcf.LiftM3</span><span>
</span><a name="line-335"></a><span>      </span><span class="hs-identifier hs-type">Fcf.UnMaybe</span><span>
</span><a name="line-336"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fcf.Pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fcf.Pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fcf.TError</span><span>
</span><a name="line-338"></a><span>         </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;Parameter used here must have no explicit \&quot;default\&quot; entrypoint&quot;</span><span> </span><span class="hs-special">'</span><span class="hs-operator hs-type">:$$:</span><span>
</span><a name="line-339"></a><span>          </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;In parameter type `&quot;</span><span> </span><span class="hs-special">'</span><span class="hs-operator hs-type">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">ShowType</span><span> </span><a href="#local-6989586621679296935"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;`&quot;</span><span>
</span><a name="line-340"></a><span>         </span><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-342"></a><span>      </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#LookupParameterEntryPoint"><span class="hs-identifier hs-type">LookupParameterEntryPoint</span></a><span> </span><a href="#local-6989586621679296935"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="Lorentz.EntryPoints.Core.html#DefaultEpName"><span class="hs-identifier hs-type">DefaultEpName</span></a><span class="hs-special">)</span><span>
</span><a name="line-343"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-comment">-- | Similar to 'ForbidExplicitDefaultEntryPoint', but in a version which</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- the compiler can work with (and which produces errors confusing for users :/)</span><span>
</span><a name="line-347"></a><span class="hs-keyword">type</span><span> </span><a name="NoExplicitDefaultEntryPoint"><a href="Lorentz.EntryPoints.Core.html#NoExplicitDefaultEntryPoint"><span class="hs-identifier">NoExplicitDefaultEntryPoint</span></a></a><span> </span><a name="local-6989586621679296934"><a href="#local-6989586621679296934"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-348"></a><span>  </span><span class="hs-identifier hs-type">Eval</span><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#LookupParameterEntryPoint"><span class="hs-identifier hs-type">LookupParameterEntryPoint</span></a><span> </span><a href="#local-6989586621679296934"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="Lorentz.EntryPoints.Core.html#DefaultEpName"><span class="hs-identifier hs-type">DefaultEpName</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span class="hs-comment">-- | Call root entrypoint safely.</span><span>
</span><a name="line-351"></a><span class="hs-identifier">sepcCallRootChecked</span><span>
</span><a name="line-352"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297778"><a href="#local-6989586621679297778"><span class="hs-identifier">cp</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-353"></a><span>     </span><span class="hs-special">(</span><a href="Lorentz.Constraints.Scopes.html#NiceParameter"><span class="hs-identifier hs-type">NiceParameter</span></a><span> </span><a href="#local-6989586621679297778"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ForbidExplicitDefaultEntryPoint"><span class="hs-identifier hs-type">ForbidExplicitDefaultEntryPoint</span></a><span> </span><a href="#local-6989586621679297778"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">SomeEntryPointCall</span><span> </span><a href="#local-6989586621679297778"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-355"></a><a name="sepcCallRootChecked"><a href="Lorentz.EntryPoints.Core.html#sepcCallRootChecked"><span class="hs-identifier">sepcCallRootChecked</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sepcCallRootUnsafe</span><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="Lorentz.Constraints.Scopes.html#niceParameterEvi"><span class="hs-identifier hs-var">niceParameterEvi</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297778"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-356"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-357"></a><span>    </span><span class="hs-comment">-- Avoiding redundant-constraints warning.</span><span>
</span><a name="line-358"></a><span>    </span><a name="local-6989586621679298101"><a href="#local-6989586621679298101"><span class="hs-identifier">_validUsage</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Dict</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ForbidExplicitDefaultEntryPoint"><span class="hs-identifier hs-type">ForbidExplicitDefaultEntryPoint</span></a><span> </span><a href="#local-6989586621679297778"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>
</span><a name="line-360"></a><span class="hs-comment">-- | Which entrypoint to call.</span><span>
</span><a name="line-361"></a><span class="hs-comment">--</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- We intentionally distinguish default and non-default cases because</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- this makes API more details-agnostic.</span><span>
</span><a name="line-364"></a><span class="hs-keyword">data</span><span> </span><a name="EntryPointRef"><a href="Lorentz.EntryPoints.Core.html#EntryPointRef"><span class="hs-identifier">EntryPointRef</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679296932"><a href="#local-6989586621679296932"><span class="hs-identifier">mname</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-365"></a><span>  </span><span class="hs-comment">-- | Call the default entrypoint, or root if no explicit default is assigned.</span><span>
</span><a name="line-366"></a><span>  </span><a name="CallDefault"><a href="Lorentz.EntryPoints.Core.html#CallDefault"><span class="hs-identifier">CallDefault</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointRef"><span class="hs-identifier hs-type">EntryPointRef</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span>  </span><span class="hs-comment">-- | Call the given entrypoint; calling default is not treated specially.</span><span>
</span><a name="line-369"></a><span>  </span><span class="hs-comment">-- You have to provide entrypoint name via passing it as type argument.</span><span>
</span><a name="line-370"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-371"></a><span>  </span><span class="hs-comment">-- Unfortunatelly, here we cannot accept a label because in most cases our</span><span>
</span><a name="line-372"></a><span>  </span><span class="hs-comment">-- entrypoints begin from capital letter (being derived from constructor name),</span><span>
</span><a name="line-373"></a><span>  </span><span class="hs-comment">-- while labels must start from a lower-case letter, and there is no way to</span><span>
</span><a name="line-374"></a><span>  </span><span class="hs-comment">-- make a conversion at type-level.</span><span>
</span><a name="line-375"></a><span>  </span><a name="Call"><a href="Lorentz.EntryPoints.Core.html#Call"><span class="hs-identifier">Call</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lorentz.EntryPoints.Core.html#NiceEntryPointName"><span class="hs-identifier hs-type">NiceEntryPointName</span></a><span> </span><a href="#local-6989586621679296933"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointRef"><span class="hs-identifier hs-type">EntryPointRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Just</span><span> </span><a href="#local-6989586621679296933"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>
</span><a name="line-377"></a><span class="hs-comment">-- | Constraint on type-level entrypoint name specifier.</span><span>
</span><a name="line-378"></a><span class="hs-keyword">type</span><span> </span><a name="NiceEntryPointName"><a href="Lorentz.EntryPoints.Core.html#NiceEntryPointName"><span class="hs-identifier">NiceEntryPointName</span></a></a><span> </span><a name="local-6989586621679296931"><a href="#local-6989586621679296931"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">KnownSymbol</span><span> </span><a href="#local-6989586621679296931"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ForbidDefaultName"><span class="hs-identifier hs-type">ForbidDefaultName</span></a><span> </span><a href="#local-6989586621679296931"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-379"></a><span>
</span><a name="line-380"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="ForbidDefaultName"><a href="Lorentz.EntryPoints.Core.html#ForbidDefaultName"><span class="hs-identifier">ForbidDefaultName</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679296929"><a href="#local-6989586621679296929"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-381"></a><span>  </span><span class="hs-identifier">ForbidDefaultName</span><span> </span><span class="hs-string">&quot;Default&quot;</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-382"></a><span>    </span><span class="hs-identifier hs-type">TypeError</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;Calling `Default` entrypoint is not allowed here&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-383"></a><span>  </span><span class="hs-identifier">ForbidDefaultName</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span class="hs-identifier">eprName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297777"><a href="#local-6989586621679297777"><span class="hs-identifier">mname</span></a></a><span class="hs-operator">.</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointRef"><span class="hs-identifier hs-type">EntryPointRef</span></a><span> </span><a href="#local-6989586621679297777"><span class="hs-identifier hs-type">mname</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EpName</span><span>
</span><a name="line-386"></a><a name="eprName"><a href="Lorentz.EntryPoints.Core.html#eprName"><span class="hs-identifier">eprName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-387"></a><span>  </span><a href="Lorentz.EntryPoints.Core.html#CallDefault"><span class="hs-identifier hs-var">CallDefault</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">DefEpName</span><span>
</span><a name="line-388"></a><span>  </span><a href="Lorentz.EntryPoints.Core.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Just</span><span> </span><a href="#local-6989586621679298102"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297777"><span class="hs-identifier hs-type">mname</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-389"></a><span>    </span><span class="hs-identifier hs-var">epNameFromParamAnn</span><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Helpers.html#ctorNameToAnn"><span class="hs-identifier hs-var">ctorNameToAnn</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679298102"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span>    </span><span class="hs-operator hs-var">?:</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Empty constructor-entrypoint name&quot;</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-comment">-- | Universal entrypoint calling.</span><span>
</span><a name="line-393"></a><span class="hs-identifier">parameterEntryPointCallCustom</span><span>
</span><a name="line-394"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679297775"><a href="#local-6989586621679297775"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679297776"><a href="#local-6989586621679297776"><span class="hs-identifier">mname</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-395"></a><span>     </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679297775"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span>
</span><a name="line-396"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointRef"><span class="hs-identifier hs-type">EntryPointRef</span></a><span> </span><a href="#local-6989586621679297776"><span class="hs-identifier hs-type">mname</span></a><span>
</span><a name="line-397"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EntryPointCall</span><span> </span><a href="#local-6989586621679297775"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#GetEntryPointArgCustom"><span class="hs-identifier hs-type">GetEntryPointArgCustom</span></a><span> </span><a href="#local-6989586621679297775"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="#local-6989586621679297776"><span class="hs-identifier hs-type">mname</span></a><span class="hs-special">)</span><span>
</span><a name="line-398"></a><a name="parameterEntryPointCallCustom"><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointCallCustom"><span class="hs-identifier">parameterEntryPointCallCustom</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-399"></a><span>  </span><a href="Lorentz.EntryPoints.Core.html#CallDefault"><span class="hs-identifier hs-var">CallDefault</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-400"></a><span>    </span><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointCallDefault"><span class="hs-identifier hs-var">parameterEntryPointCallDefault</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297775"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-401"></a><span>  </span><a href="Lorentz.EntryPoints.Core.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Just</span><span> </span><a href="#local-6989586621679298103"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297776"><span class="hs-identifier hs-type">mname</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-402"></a><span>    </span><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointCall"><span class="hs-identifier hs-var">parameterEntryPointCall</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297775"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromLabel</span><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679298103"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span class="hs-comment">-- | Universal entrypoint lookup.</span><span>
</span><a name="line-405"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="GetEntryPointArgCustom"><a href="Lorentz.EntryPoints.Core.html#GetEntryPointArgCustom"><span class="hs-identifier">GetEntryPointArgCustom</span></a></a><span> </span><a name="local-6989586621679296924"><a href="#local-6989586621679296924"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679296925"><a href="#local-6989586621679296925"><span class="hs-identifier">mname</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-406"></a><span>  </span><span class="hs-identifier">GetEntryPointArgCustom</span><span> </span><a href="#local-6989586621679296926"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.EntryPoints.Core.html#GetDefaultEntryPointArg"><span class="hs-identifier hs-type">GetDefaultEntryPointArg</span></a><span> </span><a href="#local-6989586621679296926"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-407"></a><span>  </span><span class="hs-identifier">GetEntryPointArgCustom</span><span> </span><a href="#local-6989586621679296927"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Just</span><span> </span><a href="#local-6989586621679296928"><span class="hs-identifier hs-type">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.EntryPoints.Core.html#GetEntryPointArg"><span class="hs-identifier hs-type">GetEntryPointArg</span></a><span> </span><a href="#local-6989586621679296927"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="#local-6989586621679296928"><span class="hs-identifier hs-type">name</span></a><span>
</span><a name="line-408"></a><span>
</span><a name="line-409"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- Type class for functions that take entrypoint name as argument</span><span>
</span><a name="line-411"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span class="hs-comment">-- | When we call a Lorentz contract we should pass entrypoint name</span><span>
</span><a name="line-414"></a><span class="hs-comment">-- and corresponding argument. Ideally we want to statically check</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- that parameter has entrypoint with given name and</span><span>
</span><a name="line-416"></a><span class="hs-comment">-- argument. Constraint defined by this type class holds for contract</span><span>
</span><a name="line-417"></a><span class="hs-comment">-- with parameter @cp@ that have entrypoint matching @name@ with type</span><span>
</span><a name="line-418"></a><span class="hs-comment">-- @arg@.</span><span>
</span><a name="line-419"></a><span class="hs-comment">--</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- In order to check this property statically, we need to know entrypoint</span><span>
</span><a name="line-421"></a><span class="hs-comment">-- name in compile time, 'EntryPointRef' type serves this purpose.</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- If entrypoint name is not known, one can use 'TrustEpName' wrapper</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- to take responsibility for presence of this entrypoint.</span><span>
</span><a name="line-424"></a><span class="hs-comment">--</span><span>
</span><a name="line-425"></a><span class="hs-comment">-- If you want to call a function which has this constraint, you have</span><span>
</span><a name="line-426"></a><span class="hs-comment">-- two options:</span><span>
</span><a name="line-427"></a><span class="hs-comment">-- 1. Pass contract parameter @cp@ using type application, pass 'EntryPointRef'</span><span>
</span><a name="line-428"></a><span class="hs-comment">-- as a value and pass entrypoint argument. Type system will check that</span><span>
</span><a name="line-429"></a><span class="hs-comment">-- @cp@ has an entrypoint with given reference and type.</span><span>
</span><a name="line-430"></a><span class="hs-comment">-- 2. Pass 'EpName' wrapped into 'TrustEpName' and entrypoint argument.</span><span>
</span><a name="line-431"></a><span class="hs-comment">-- In this case passing contract parameter is not necessary, you do not even</span><span>
</span><a name="line-432"></a><span class="hs-comment">-- have to know it.</span><span>
</span><a name="line-433"></a><span class="hs-keyword">class</span><span> </span><a name="HasEntryPointArg"><a href="Lorentz.EntryPoints.Core.html#HasEntryPointArg"><span class="hs-identifier">HasEntryPointArg</span></a></a><span> </span><a name="local-6989586621679296921"><a href="#local-6989586621679296921"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679296922"><a href="#local-6989586621679296922"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679296923"><a href="#local-6989586621679296923"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-434"></a><span>  </span><span class="hs-comment">-- | Data returned by this method may look somewhat arbitrary.</span><span>
</span><a name="line-435"></a><span>  </span><span class="hs-comment">-- 'EpName' is obviously needed because @name@ can be</span><span>
</span><a name="line-436"></a><span>  </span><span class="hs-comment">-- 'EntryPointRef' or 'TrustEpName'.  @Dict@ is returned because in</span><span>
</span><a name="line-437"></a><span>  </span><span class="hs-comment">-- 'EntryPointRef' case we get this evidence for free and don't want</span><span>
</span><a name="line-438"></a><span>  </span><span class="hs-comment">-- to use it. We seem to always need it anyway.</span><span>
</span><a name="line-439"></a><span>  </span><a name="useHasEntryPointArg"><a href="Lorentz.EntryPoints.Core.html#useHasEntryPointArg"><span class="hs-identifier">useHasEntryPointArg</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679296922"><span class="hs-identifier hs-type">name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Dict</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ParameterScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToT</span><span> </span><a href="#local-6989586621679296923"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">EpName</span><span class="hs-special">)</span><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span class="hs-comment">-- | 'HasEntryPointArg' constraint specialized to default entrypoint.</span><span>
</span><a name="line-442"></a><span class="hs-keyword">type</span><span> </span><a name="HasDefEntryPointArg"><a href="Lorentz.EntryPoints.Core.html#HasDefEntryPointArg"><span class="hs-identifier">HasDefEntryPointArg</span></a></a><span> </span><a name="local-6989586621679296918"><a href="#local-6989586621679296918"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679296919"><a href="#local-6989586621679296919"><span class="hs-identifier">defEpName</span></a></a><span> </span><a name="local-6989586621679296920"><a href="#local-6989586621679296920"><span class="hs-identifier">defArg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-443"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">defEpName</span><span> </span><span class="hs-glyph">~</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointRef"><span class="hs-identifier hs-type">EntryPointRef</span></a><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span>
</span><a name="line-444"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#HasEntryPointArg"><span class="hs-identifier hs-type">HasEntryPointArg</span></a><span> </span><a href="#local-6989586621679296918"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="#local-6989586621679296919"><span class="hs-identifier hs-type">defEpName</span></a><span> </span><a href="#local-6989586621679296920"><span class="hs-identifier hs-type">defArg</span></a><span>
</span><a name="line-445"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-keyword">instance</span><span>
</span><a name="line-448"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GetEntryPointArgCustom</span><span> </span><a href="#local-6989586621679297771"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="#local-6989586621679297772"><span class="hs-identifier hs-type">mname</span></a><span> </span><span class="hs-glyph">~</span><span> </span><a href="#local-6989586621679297773"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679297771"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-449"></a><span>  </span><a href="Lorentz.EntryPoints.Core.html#HasEntryPointArg"><span class="hs-identifier hs-type">HasEntryPointArg</span></a><span> </span><a href="#local-6989586621679297771"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#EntryPointRef"><span class="hs-identifier hs-type">EntryPointRef</span></a><span> </span><a href="#local-6989586621679297772"><span class="hs-identifier hs-type">mname</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679297773"><span class="hs-identifier hs-type">arg</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-450"></a><span>  </span><a name="local-8214565720324071771"><a href="Lorentz.EntryPoints.Core.html#useHasEntryPointArg"><span class="hs-identifier">useHasEntryPointArg</span></a></a><span> </span><a name="local-6989586621679297774"><a href="#local-6989586621679297774"><span class="hs-identifier">epRef</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-451"></a><span>    </span><span class="hs-identifier hs-var">withDict</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Constraints.Scopes.html#niceParameterEvi"><span class="hs-identifier hs-var">niceParameterEvi</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297771"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-452"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Lorentz.EntryPoints.Core.html#parameterEntryPointCallCustom"><span class="hs-identifier hs-var">parameterEntryPointCallCustom</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297771"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="#local-6989586621679297774"><span class="hs-identifier hs-var">epRef</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-453"></a><span>      </span><span class="hs-identifier hs-var">EntryPointCall</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Dict</span><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#eprName"><span class="hs-identifier hs-var">eprName</span></a><span> </span><a href="#local-6989586621679297774"><span class="hs-identifier hs-var">epRef</span></a><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>
</span><a name="line-455"></a><span class="hs-comment">-- | This wrapper allows to pass untyped 'EpName' and bypass checking</span><span>
</span><a name="line-456"></a><span class="hs-comment">-- that entrypoint with given name and type exists.</span><span>
</span><a name="line-457"></a><span class="hs-keyword">newtype</span><span> </span><a name="TrustEpName"><a href="Lorentz.EntryPoints.Core.html#TrustEpName"><span class="hs-identifier">TrustEpName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TrustEpName"><a href="Lorentz.EntryPoints.Core.html#TrustEpName"><span class="hs-identifier">TrustEpName</span></a></a><span> </span><span class="hs-identifier hs-type">EpName</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.Constraints.Scopes.html#NiceParameter"><span class="hs-identifier hs-type">NiceParameter</span></a><span> </span><a href="#local-6989586621679297768"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-460"></a><span>  </span><a href="Lorentz.EntryPoints.Core.html#HasEntryPointArg"><span class="hs-identifier hs-type">HasEntryPointArg</span></a><span> </span><a href="#local-6989586621679297769"><span class="hs-identifier hs-type">cp</span></a><span> </span><a href="Lorentz.EntryPoints.Core.html#TrustEpName"><span class="hs-identifier hs-type">TrustEpName</span></a><span> </span><a href="#local-6989586621679297768"><span class="hs-identifier hs-type">arg</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-461"></a><span>  </span><a name="local-8214565720324071771"><a href="Lorentz.EntryPoints.Core.html#useHasEntryPointArg"><span class="hs-identifier">useHasEntryPointArg</span></a></a><span> </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#TrustEpName"><span class="hs-identifier hs-var">TrustEpName</span></a><span> </span><a name="local-6989586621679297770"><a href="#local-6989586621679297770"><span class="hs-identifier">epName</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Dict</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679297770"><span class="hs-identifier hs-var">epName</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="Lorentz.Constraints.Scopes.html#niceParameterEvi"><span class="hs-identifier hs-var">niceParameterEvi</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297768"><span class="hs-identifier hs-type">arg</span></a><span>
</span><a name="line-462"></a><span>
</span><a name="line-463"></a><span class="hs-comment">-- | Checks that the given parameter consists of some specific entrypoint. Similar as</span><span>
</span><a name="line-464"></a><span class="hs-comment">-- `HasEntryPointArg` but ensures that the argument matches the following datatype.</span><span>
</span><a name="line-465"></a><span class="hs-keyword">type</span><span> </span><a name="HasEntryPointOfType"><a href="Lorentz.EntryPoints.Core.html#HasEntryPointOfType"><span class="hs-identifier">HasEntryPointOfType</span></a></a><span> </span><a name="local-6989586621679296915"><a href="#local-6989586621679296915"><span class="hs-identifier">param</span></a></a><span> </span><a name="local-6989586621679296916"><a href="#local-6989586621679296916"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621679296917"><a href="#local-6989586621679296917"><span class="hs-identifier">exp</span></a></a><span>
</span><a name="line-466"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GetEntryPointArgCustom</span><span> </span><a href="#local-6989586621679296915"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Just</span><span> </span><a href="#local-6989586621679296916"><span class="hs-identifier hs-type">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">~</span><span> </span><a href="#local-6989586621679296917"><span class="hs-identifier hs-type">exp</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ParameterDeclaresEntryPoints"><span class="hs-identifier hs-type">ParameterDeclaresEntryPoints</span></a><span> </span><a href="#local-6989586621679296915"><span class="hs-identifier hs-type">param</span></a><span class="hs-special">)</span><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span class="hs-comment">-- | A helper datatype which prettifies interface for `ParameterContainsEntryPoints`.</span><span>
</span><a name="line-469"></a><span class="hs-keyword">data</span><span> </span><a name="NamedEp"><a href="Lorentz.EntryPoints.Core.html#NamedEp"><span class="hs-identifier">NamedEp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NamedEp"><a href="Lorentz.EntryPoints.Core.html#NamedEp"><span class="hs-identifier">NamedEp</span></a></a><span> </span><span class="hs-identifier hs-type">Symbol</span><span> </span><span class="hs-identifier hs-type">Kind.Type</span><span>
</span><a name="line-470"></a><span class="hs-keyword">type</span><span> </span><a name="local-6989586621679296913"><a href="#local-6989586621679296913"><span class="hs-identifier">n</span></a></a><span> </span><a name="%3A%3E"><a href="Lorentz.EntryPoints.Core.html#%3A%3E"><span class="hs-operator">:&gt;</span></a></a><span> </span><a name="local-6989586621679296914"><a href="#local-6989586621679296914"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><a href="Lorentz.EntryPoints.Core.html#NamedEp"><span class="hs-identifier hs-type">NamedEp</span></a><span> </span><a href="#local-6989586621679296913"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679296914"><span class="hs-identifier hs-type">ty</span></a><span>
</span><a name="line-471"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">0</span><span> </span><a href="Lorentz.EntryPoints.Core.html#%3A%3E"><span class="hs-operator hs-var">:&gt;</span></a><span>
</span><a name="line-472"></a><span>
</span><a name="line-473"></a><span class="hs-comment">-- | Check that the given entrypoint has some fields inside.</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- This interface allows for an abstraction of contract parameter so</span><span>
</span><a name="line-475"></a><span class="hs-comment">-- that it requires some *minimal* specification, but not a concrete one.</span><span>
</span><a name="line-476"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span>
</span><a name="line-477"></a><span>    </span><a name="ParameterContainsEntryPoints"><a href="Lorentz.EntryPoints.Core.html#ParameterContainsEntryPoints"><span class="hs-identifier">ParameterContainsEntryPoints</span></a></a><span> </span><a name="local-6989586621679296906"><a href="#local-6989586621679296906"><span class="hs-identifier">param</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679296907"><a href="#local-6989586621679296907"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Lorentz.EntryPoints.Core.html#NamedEp"><span class="hs-identifier hs-type">NamedEp</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span>
</span><a name="line-478"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-479"></a><span>  </span><span class="hs-identifier">ParameterContainsEntryPoints</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-480"></a><span>  </span><span class="hs-identifier">ParameterContainsEntryPoints</span><span> </span><a href="#local-6989586621679296909"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#%3A%3E"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="Lorentz.EntryPoints.Core.html#%3A%3E"><span class="hs-operator hs-type">:&gt;</span></a><span> </span><a href="#local-6989586621679296911"><span class="hs-identifier hs-type">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679296912"><span class="hs-identifier hs-type">rest</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-481"></a><span>    </span><span class="hs-special">(</span><a href="Lorentz.EntryPoints.Core.html#HasEntryPointOfType"><span class="hs-identifier hs-type">HasEntryPointOfType</span></a><span> </span><a href="#local-6989586621679296909"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679296910"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679296911"><span class="hs-identifier hs-type">ty</span></a><span class="hs-special">,</span><span> </span><a href="Lorentz.EntryPoints.Core.html#ParameterContainsEntryPoints"><span class="hs-identifier hs-type">ParameterContainsEntryPoints</span></a><span> </span><a href="#local-6989586621679296909"><span class="hs-identifier hs-type">param</span></a><span> </span><a href="#local-6989586621679296912"><span class="hs-identifier hs-type">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-484"></a><span class="hs-comment">-- Trivial implementation</span><span>
</span><a name="line-485"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span class="hs-comment">-- | No entrypoints declared, parameter type will serve as argument type</span><span>
</span><a name="line-488"></a><span class="hs-comment">-- of the only existing entrypoint (default one).</span><span>
</span><a name="line-489"></a><span class="hs-keyword">data</span><span> </span><a name="EpdNone"><a href="Lorentz.EntryPoints.Core.html#EpdNone"><span class="hs-identifier">EpdNone</span></a></a><span>
</span><a name="line-490"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Lorentz.TypeAnns.html#HasTypeAnn"><span class="hs-identifier hs-type">HasTypeAnn</span></a><span> </span><a href="#local-6989586621679297767"><span class="hs-identifier hs-type">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EntryPointsDerivation"><span class="hs-identifier hs-type">EntryPointsDerivation</span></a><span> </span><a href="Lorentz.EntryPoints.Core.html#EpdNone"><span class="hs-identifier hs-type">EpdNone</span></a><span> </span><a href="#local-6989586621679297767"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-491"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">EpdAllEntryPoints</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpdNone"><span class="hs-identifier hs-type">EpdNone</span></a><span> </span><a href="#local-6989586621679297767"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-492"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">EpdLookupEntryPoint</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpdNone"><span class="hs-identifier hs-type">EpdNone</span></a><span> </span><a href="#local-6989586621679297767"><span class="hs-identifier hs-type">cp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Fcf.ConstFn</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span>
</span><a name="line-493"></a><span>  </span><a name="local-8214565720324071804"><a href="Lorentz.EntryPoints.Core.html#epdNotes"><span class="hs-identifier">epdNotes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.TypeAnns.html#getTypeAnn"><span class="hs-identifier hs-var">getTypeAnn</span></a><span> </span><span class="hs-glyph">@</span><a href="#local-6989586621679297767"><span class="hs-identifier hs-type">cp</span></a><span>
</span><a name="line-494"></a><span>  </span><a name="local-8214565720324071805"><a href="Lorentz.EntryPoints.Core.html#epdCall"><span class="hs-identifier">epdCall</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lorentz.EntryPoints.Core.html#EpConstructionFailed"><span class="hs-identifier hs-var">EpConstructionFailed</span></a><span>
</span><a name="line-495"></a><span>  </span><a name="local-8214565720324071806"><a href="Lorentz.EntryPoints.Core.html#epdDescs"><span class="hs-identifier">epdDescs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RNil</span><span>
</span><a name="line-496"></a></pre></body></html>