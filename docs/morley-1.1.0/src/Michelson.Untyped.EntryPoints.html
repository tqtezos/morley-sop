<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Michelson.Untyped.EntryPoints</span><span>
</span><a name="line-2"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-3"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#DefEpName"><span class="hs-identifier hs-var">DefEpName</span></a><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#epNameFromParamAnn"><span class="hs-identifier hs-var">epNameFromParamAnn</span></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#epNameToParamAnn"><span class="hs-identifier hs-var">epNameToParamAnn</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#epNameFromRefAnn"><span class="hs-identifier hs-var">epNameFromRefAnn</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#epNameToRefAnn"><span class="hs-identifier hs-var">epNameToRefAnn</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpNameFromRefAnnError"><span class="hs-identifier hs-type">EpNameFromRefAnnError</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#mkEntrypointsMap"><span class="hs-identifier hs-var">mkEntrypointsMap</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Default</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Default</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Fmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Buildable</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pretty</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+|</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">|+</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Test.QuickCheck</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Arbitrary</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">suchThatMap</span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="Michelson.Untyped.Annotation.html"><span class="hs-identifier">Michelson.Untyped.Annotation</span></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Michelson.Untyped.Type.html"><span class="hs-identifier">Michelson.Untyped.Type</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Util.CLI.html"><span class="hs-identifier">Util.CLI</span></a><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-comment">-- | Entrypoint name.</span><span>
</span><a name="line-22"></a><span class="hs-comment">--</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- Empty if this entrypoint is default one.</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- Cannot be equal to &quot;default&quot;, the reference implementation forbids that.</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- Also, set of allowed characters should be the same as in annotations.</span><span>
</span><a name="line-26"></a><span class="hs-keyword">newtype</span><span> </span><a name="EpName"><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier">EpName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EpNameUnsafe"><a href="Michelson.Untyped.EntryPoints.html#EpNameUnsafe"><span class="hs-identifier">EpNameUnsafe</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unEpName"><a href="Michelson.Untyped.EntryPoints.html#unEpName"><span class="hs-identifier">unEpName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">pattern</span><span> </span><span class="hs-identifier">DefEpName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">pattern</span><span> </span><a name="DefEpName"><a href="Michelson.Untyped.EntryPoints.html#DefEpName"><span class="hs-identifier">DefEpName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpNameUnsafe"><span class="hs-identifier hs-var">EpNameUnsafe</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-35"></a><span>  </span><a name="local-8214565720323801212"><span class="hs-identifier">build</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-36"></a><span>    </span><a href="Michelson.Untyped.EntryPoints.html#DefEpName"><span class="hs-identifier hs-var">DefEpName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;&lt;default&gt;&quot;</span><span>
</span><a name="line-37"></a><span>    </span><a href="Michelson.Untyped.EntryPoints.html#EpNameUnsafe"><span class="hs-identifier hs-var">EpNameUnsafe</span></a><span> </span><a name="local-6989586621679573683"><a href="#local-6989586621679573683"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">build</span><span> </span><a href="#local-6989586621679573683"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Default</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-40"></a><span>  </span><a name="local-8214565720323800136"><span class="hs-identifier">def</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpNameUnsafe"><span class="hs-identifier hs-var">EpNameUnsafe</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">-- | Make up 'EpName' from annotation in parameter type declaration.</span><span>
</span><a name="line-43"></a><span class="hs-comment">--</span><span>
</span><a name="line-44"></a><span class="hs-comment">-- Returns 'Nothing' if no entrypoint is assigned here.</span><span>
</span><a name="line-45"></a><span class="hs-identifier">epNameFromParamAnn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Untyped.Annotation.html#FieldAnn"><span class="hs-identifier hs-type">FieldAnn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span>
</span><a name="line-46"></a><a name="epNameFromParamAnn"><a href="Michelson.Untyped.EntryPoints.html#epNameFromParamAnn"><span class="hs-identifier">epNameFromParamAnn</span></a></a><span> </span><a name="local-6989586621679573684"><a href="#local-6989586621679573684"><span class="hs-identifier">an</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Michelson.Untyped.Annotation.html#Annotation"><span class="hs-identifier hs-var">Annotation</span></a><span> </span><a name="local-6989586621679573685"><a href="#local-6989586621679573685"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679573684"><span class="hs-identifier hs-var">an</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Michelson.Untyped.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679573685"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;default&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Michelson.Untyped.EntryPoints.html#EpNameUnsafe"><span class="hs-identifier hs-var">EpNameUnsafe</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpNameUnsafe"><span class="hs-identifier hs-var">EpNameUnsafe</span></a><span> </span><a href="#local-6989586621679573685"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- | Turn entrypoint name into annotation for contract parameter declaration.</span><span>
</span><a name="line-52"></a><span class="hs-identifier">epNameToParamAnn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Michelson.Untyped.Annotation.html#FieldAnn"><span class="hs-identifier hs-type">FieldAnn</span></a><span>
</span><a name="line-53"></a><a name="epNameToParamAnn"><a href="Michelson.Untyped.EntryPoints.html#epNameToParamAnn"><span class="hs-identifier">epNameToParamAnn</span></a></a><span> </span><span class="hs-special">(</span><a href="Michelson.Untyped.EntryPoints.html#EpNameUnsafe"><span class="hs-identifier hs-var">EpNameUnsafe</span></a><span> </span><a name="local-6989586621679573686"><a href="#local-6989586621679573686"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679573686"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Untyped.Annotation.html#ann"><span class="hs-identifier hs-var">ann</span></a><span> </span><span class="hs-string">&quot;default&quot;</span><span>
</span><a name="line-55"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Untyped.Annotation.html#ann"><span class="hs-identifier hs-var">ann</span></a><span> </span><a href="#local-6989586621679573686"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-keyword">data</span><span> </span><a name="EpNameFromRefAnnError"><a href="Michelson.Untyped.EntryPoints.html#EpNameFromRefAnnError"><span class="hs-identifier">EpNameFromRefAnnError</span></a></a><span>
</span><a name="line-58"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="InEpNameBadAnnotation"><a href="Michelson.Untyped.EntryPoints.html#InEpNameBadAnnotation"><span class="hs-identifier">InEpNameBadAnnotation</span></a></a><span> </span><a href="Michelson.Untyped.Annotation.html#FieldAnn"><span class="hs-identifier hs-type">FieldAnn</span></a><span>
</span><a name="line-59"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpNameFromRefAnnError"><span class="hs-identifier hs-type">EpNameFromRefAnnError</span></a><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpNameFromRefAnnError"><span class="hs-identifier hs-type">EpNameFromRefAnnError</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-64"></a><span>  </span><a name="local-8214565720323801212"><span class="hs-identifier">build</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-65"></a><span>    </span><a href="Michelson.Untyped.EntryPoints.html#InEpNameBadAnnotation"><span class="hs-identifier hs-var">InEpNameBadAnnotation</span></a><span> </span><span class="hs-special">(</span><a href="Michelson.Untyped.Annotation.html#Annotation"><span class="hs-identifier hs-var">Annotation</span></a><span> </span><a name="local-6989586621679573682"><a href="#local-6989586621679573682"><span class="hs-identifier">an</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-66"></a><span>      </span><span class="hs-string">&quot;Invalid entrypoint reference `&quot;</span><span> </span><span class="hs-operator hs-var">+|</span><span> </span><a href="#local-6989586621679573682"><span class="hs-identifier hs-var">an</span></a><span> </span><span class="hs-operator hs-var">|+</span><span> </span><span class="hs-string">&quot;`&quot;</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | Make up 'EpName' from annotation which is reference to an entrypoint</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- (e.g. annotation in @CONTRACT@ instruction).</span><span>
</span><a name="line-70"></a><span class="hs-comment">--</span><span>
</span><a name="line-71"></a><span class="hs-comment">-- Fails if annotation is invalid.</span><span>
</span><a name="line-72"></a><span class="hs-identifier">epNameFromRefAnn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Untyped.Annotation.html#FieldAnn"><span class="hs-identifier hs-type">FieldAnn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpNameFromRefAnnError"><span class="hs-identifier hs-type">EpNameFromRefAnnError</span></a><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span>
</span><a name="line-73"></a><a name="epNameFromRefAnn"><a href="Michelson.Untyped.EntryPoints.html#epNameFromRefAnn"><span class="hs-identifier">epNameFromRefAnn</span></a></a><span> </span><a name="local-6989586621679573687"><a href="#local-6989586621679573687"><span class="hs-identifier">an</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Michelson.Untyped.Annotation.html#Annotation"><span class="hs-identifier hs-var">Annotation</span></a><span> </span><a name="local-6989586621679573688"><a href="#local-6989586621679573688"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679573688"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;default&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#InEpNameBadAnnotation"><span class="hs-identifier hs-var">InEpNameBadAnnotation</span></a><span> </span><a href="#local-6989586621679573687"><span class="hs-identifier hs-var">an</span></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpNameUnsafe"><span class="hs-identifier hs-var">EpNameUnsafe</span></a><span> </span><a href="#local-6989586621679573688"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-comment">-- | Turn entrypoint name into annotation used as reference to entrypoint.</span><span>
</span><a name="line-78"></a><span class="hs-identifier">epNameToRefAnn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Michelson.Untyped.Annotation.html#FieldAnn"><span class="hs-identifier hs-type">FieldAnn</span></a><span>
</span><a name="line-79"></a><a name="epNameToRefAnn"><a href="Michelson.Untyped.EntryPoints.html#epNameToRefAnn"><span class="hs-identifier">epNameToRefAnn</span></a></a><span> </span><span class="hs-special">(</span><a href="Michelson.Untyped.EntryPoints.html#EpNameUnsafe"><span class="hs-identifier hs-var">EpNameUnsafe</span></a><span> </span><a name="local-6989586621679573689"><a href="#local-6989586621679573689"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Untyped.Annotation.html#ann"><span class="hs-identifier hs-var">ann</span></a><span> </span><a href="#local-6989586621679573689"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Arbitrary</span><span> </span><a href="Michelson.Untyped.Annotation.html#FieldAnn"><span class="hs-identifier hs-type">FieldAnn</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Arbitrary</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-82"></a><span>  </span><a name="local-8214565720323785609"><span class="hs-identifier">arbitrary</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">arbitrary</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">suchThatMap</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rightToMaybe</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#epNameFromRefAnn"><span class="hs-identifier hs-var">epNameFromRefAnn</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-keyword">instance</span><span> </span><a href="Util.CLI.html#HasCLReader"><span class="hs-identifier hs-type">HasCLReader</span></a><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-85"></a><span>  </span><a name="local-8214565720324342181"><a href="Util.CLI.html#getReader"><span class="hs-identifier">getReader</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">eitherReader</span><span> </span><a href="#local-6989586621679573679"><span class="hs-identifier hs-var">parseEntrypointDo</span></a><span>
</span><a name="line-86"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-87"></a><span>      </span><a name="local-6989586621679573679"><a href="#local-6989586621679573679"><span class="hs-identifier">parseEntrypointDo</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toText</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621679573680"><a href="#local-6989586621679573680"><span class="hs-identifier">txt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-88"></a><span>        </span><a name="local-6989586621679573681"><a href="#local-6989586621679573681"><span class="hs-identifier">an</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-89"></a><span>          </span><a href="Michelson.Untyped.Annotation.html#mkAnnotation"><span class="hs-identifier hs-var">mkAnnotation</span></a><span> </span><a href="#local-6989586621679573680"><span class="hs-identifier hs-var">txt</span></a><span>
</span><a name="line-90"></a><span>          </span><span class="hs-operator hs-var">&amp;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mappend</span><span> </span><span class="hs-string">&quot;Failed to parse entrypoint: &quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">pretty</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>        </span><a href="Michelson.Untyped.EntryPoints.html#epNameFromRefAnn"><span class="hs-identifier hs-var">epNameFromRefAnn</span></a><span> </span><a href="#local-6989586621679573681"><span class="hs-identifier hs-var">an</span></a><span>
</span><a name="line-92"></a><span>          </span><span class="hs-operator hs-var">&amp;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-identifier hs-var">pretty</span><span>
</span><a name="line-93"></a><span>  </span><a name="local-8214565720324342182"><a href="Util.CLI.html#getMetavar"><span class="hs-identifier">getMetavar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;ENTRYPOINT&quot;</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | Given an untyped type, extract a map that maps entrypoint names to the</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- their parameter types. If there are duplicate entrypoints in the given Type</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- then the duplicate entrypoints at a deeper nesting level will get</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- overwritten with the ones that are on top.</span><span>
</span><a name="line-99"></a><span class="hs-identifier">mkEntrypointsMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Untyped.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span> </span><a href="Michelson.Untyped.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-100"></a><a name="mkEntrypointsMap"><a href="Michelson.Untyped.EntryPoints.html#mkEntrypointsMap"><span class="hs-identifier">mkEntrypointsMap</span></a></a><span> </span><span class="hs-special">(</span><a href="Michelson.Untyped.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621679573690"><a href="#local-6989586621679573690"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679573690"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-101"></a><span>  </span><span class="hs-comment">-- We are only interested in `Or` branches to extract entrypoint</span><span>
</span><a name="line-102"></a><span>  </span><span class="hs-comment">-- annotations.</span><span>
</span><a name="line-103"></a><span>  </span><a href="Michelson.Untyped.Type.html#TOr"><span class="hs-identifier hs-var">TOr</span></a><span> </span><a name="local-6989586621679573696"><a href="#local-6989586621679573696"><span class="hs-identifier">f1</span></a></a><span> </span><a name="local-6989586621679573697"><a href="#local-6989586621679573697"><span class="hs-identifier">f2</span></a></a><span> </span><a name="local-6989586621679573698"><a href="#local-6989586621679573698"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679573699"><a href="#local-6989586621679573699"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679573691"><span class="hs-identifier hs-var">extractSubmap</span></a><span> </span><a href="#local-6989586621679573696"><span class="hs-identifier hs-var">f1</span></a><span> </span><a href="#local-6989586621679573698"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679573691"><span class="hs-identifier hs-var">extractSubmap</span></a><span> </span><a href="#local-6989586621679573697"><span class="hs-identifier hs-var">f2</span></a><span> </span><a href="#local-6989586621679573699"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-104"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-105"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-identifier">extractSubmap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Untyped.Annotation.html#FieldAnn"><span class="hs-identifier hs-type">FieldAnn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Michelson.Untyped.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#EpName"><span class="hs-identifier hs-type">EpName</span></a><span> </span><a href="Michelson.Untyped.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-107"></a><span>    </span><a name="local-6989586621679573691"><a href="#local-6989586621679573691"><span class="hs-identifier">extractSubmap</span></a></a><span> </span><a name="local-6989586621679573692"><a href="#local-6989586621679573692"><span class="hs-identifier">f1</span></a></a><span> </span><a name="local-6989586621679573693"><a href="#local-6989586621679573693"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-108"></a><span>      </span><span class="hs-comment">-- If the field annotation is not empty then merge this field</span><span>
</span><a name="line-109"></a><span>      </span><span class="hs-comment">-- annotation/type pair with the entrypoint map of inner type. Else</span><span>
</span><a name="line-110"></a><span>      </span><span class="hs-comment">-- just fetch entrypoint map of inner type.</span><span>
</span><a name="line-111"></a><span>      </span><a name="local-6989586621679573694"><a href="#local-6989586621679573694"><span class="hs-identifier">innerMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#mkEntrypointsMap"><span class="hs-identifier hs-var">mkEntrypointsMap</span></a><span> </span><a href="#local-6989586621679573693"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-112"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Michelson.Untyped.EntryPoints.html#epNameFromParamAnn"><span class="hs-identifier hs-var">epNameFromParamAnn</span></a><span> </span><a href="#local-6989586621679573692"><span class="hs-identifier hs-var">f1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-113"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679573695"><a href="#local-6989586621679573695"><span class="hs-identifier">epName</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Map.singleton</span><span> </span><a href="#local-6989586621679573695"><span class="hs-identifier hs-var">epName</span></a><span> </span><a href="#local-6989586621679573693"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679573694"><span class="hs-identifier hs-var">innerMap</span></a><span>
</span><a name="line-114"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679573694"><span class="hs-identifier hs-var">innerMap</span></a><span>
</span><a name="line-115"></a></pre></body></html>