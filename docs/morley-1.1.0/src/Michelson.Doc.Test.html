<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Utilities for testing documentations sanity.</span><span>
</span><a name="line-2"></a><span class="hs-comment">--</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- These tests serve to ensure that documentation generation is not broken and</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- that user follows sane documentation structure (e.g. contract should be</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- named, some entities require description, e.t.c).</span><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Michelson.Doc.Test</span><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#mkDocTest"><span class="hs-identifier hs-var">mkDocTest</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#excludeDocTest"><span class="hs-identifier hs-var">excludeDocTest</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#excludeDocTests"><span class="hs-identifier hs-var">excludeDocTests</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#runDocTests"><span class="hs-identifier hs-var">runDocTests</span></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#expectDocTestFailure"><span class="hs-identifier hs-var">expectDocTestFailure</span></a><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span>    </span><span class="hs-comment">-- * Test predicates</span><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#testDocBasic"><span class="hs-identifier hs-var">testDocBasic</span></a><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>    </span><span class="hs-comment">-- ** Individual test predicates</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#testContractNameAtTop"><span class="hs-identifier hs-var">testContractNameAtTop</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#testNoGitInfo"><span class="hs-identifier hs-var">testNoGitInfo</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#testDocNotEmpty"><span class="hs-identifier hs-var">testDocNotEmpty</span></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#testNoAdjacentDescriptions"><span class="hs-identifier hs-var">testNoAdjacentDescriptions</span></a><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span>    </span><span class="hs-comment">-- * Utilities</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#forEachContractLayer"><span class="hs-identifier hs-var">forEachContractLayer</span></a><span>
</span><a name="line-25"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#forEachContractDocItem"><span class="hs-identifier hs-var">forEachContractDocItem</span></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Text.Lazy.Builder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toLazyText</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Fmt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Buildable</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">blockListF</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fmt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nameF</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pretty</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Stack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SrcLoc</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Test.HUnit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Assertion</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">assertBool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">assertFailure</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Test.HUnit.Lang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HUnitFailure</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Test.Tasty</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TestTree</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Test.Tasty.HUnit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">testCase</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Text.Show</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="Michelson.Doc.html"><span class="hs-identifier">Michelson.Doc</span></a><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-42"></a><span class="hs-comment">-- Framework</span><span>
</span><a name="line-43"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-comment">-- | Test case for contract documentation.</span><span>
</span><a name="line-46"></a><span class="hs-keyword">data</span><span> </span><a name="DocTest"><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier">DocTest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DocTest"><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier">DocTest</span></a></a><span>
</span><a name="line-47"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="dtDeclLoc"><a href="Michelson.Doc.Test.html#dtDeclLoc"><span class="hs-identifier">dtDeclLoc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcLoc</span><span>
</span><a name="line-48"></a><span>    </span><span class="hs-comment">-- ^ Declaration location, used to distinguish different test predicates.</span><span>
</span><a name="line-49"></a><span>    </span><span class="hs-comment">-- This is primarily used in 'excludeDocTest'.</span><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="dtDesc"><a href="Michelson.Doc.Test.html#dtDesc"><span class="hs-identifier">dtDesc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-comment">-- ^ Description of predicate, which you put to 'testCase'.</span><span>
</span><a name="line-52"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="dtSuite"><a href="Michelson.Doc.Test.html#dtSuite"><span class="hs-identifier">dtSuite</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Michelson.Doc.html#ContractDoc"><span class="hs-identifier hs-type">ContractDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Assertion</span><span>
</span><a name="line-53"></a><span>    </span><span class="hs-comment">-- ^ Test itself.</span><span>
</span><a name="line-54"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">(</span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">dtDeclLoc</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-60"></a><span>  </span><a name="local-8214565720323784705"><span class="hs-identifier">show</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pretty</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-63"></a><span>  </span><a name="local-8214565720323801212"><span class="hs-identifier">build</span></a><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-var">DocTest</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Doc test '&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">build</span><span> </span><a href="#local-6989586621681042685"><span class="hs-identifier hs-var">dtDesc</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;'&quot;</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- | Construct 'DocTest'.</span><span>
</span><a name="line-66"></a><span class="hs-comment">--</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- Note: you should not declare helpers with this function rather use it</span><span>
</span><a name="line-68"></a><span class="hs-comment">-- directly in every test suite.</span><span>
</span><a name="line-69"></a><span class="hs-identifier">mkDocTest</span><span>
</span><a name="line-70"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span>
</span><a name="line-71"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Michelson.Doc.html#ContractDoc"><span class="hs-identifier hs-type">ContractDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Assertion</span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span>
</span><a name="line-74"></a><a name="mkDocTest"><a href="Michelson.Doc.Test.html#mkDocTest"><span class="hs-identifier">mkDocTest</span></a></a><span> </span><a name="local-6989586621681042691"><a href="#local-6989586621681042691"><span class="hs-identifier">dtDesc</span></a></a><span> </span><a name="local-6989586621681042692"><a href="#local-6989586621681042692"><span class="hs-identifier">dtSuite</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-var">DocTest</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-75"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-76"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681042693"><a href="#local-6989586621681042693"><span class="hs-identifier">dtDeclLoc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">getCallStack</span><span> </span><span class="hs-identifier hs-var">callStack</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Callstacks operate in a weird way, excluding doc tests won't work&quot;</span><span>
</span><a name="line-78"></a><span>    </span><a name="local-6989586621681042694"><a href="#local-6989586621681042694"><span class="hs-identifier">layer</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681042694"><span class="hs-identifier hs-var">layer</span></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">-- | Exclude given test suite.</span><span>
</span><a name="line-81"></a><span class="hs-identifier">excludeDocTest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span class="hs-special">]</span><span>
</span><a name="line-82"></a><a name="excludeDocTest"><a href="Michelson.Doc.Test.html#excludeDocTest"><span class="hs-identifier">excludeDocTest</span></a></a><span> </span><a name="local-6989586621681042695"><a href="#local-6989586621681042695"><span class="hs-identifier">toExclude</span></a></a><span> </span><a name="local-6989586621681042696"><a href="#local-6989586621681042696"><span class="hs-identifier">tests</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-83"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">L.partition</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621681042695"><span class="hs-identifier hs-var">toExclude</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681042696"><span class="hs-identifier hs-var">tests</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-85"></a><span>      </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Not in the list of doc items: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">pretty</span><span> </span><a href="#local-6989586621681042695"><span class="hs-identifier hs-var">toExclude</span></a><span>
</span><a name="line-86"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-87"></a><span>      </span><span class="hs-comment">-- This is possible if someone abused 'mkDocTest' and created a function</span><span>
</span><a name="line-88"></a><span>      </span><span class="hs-comment">-- which calls it and this function is used to create multiple predicates</span><span>
</span><a name="line-89"></a><span>      </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Running invalid doc predicates: multiple ones were considered equal&quot;</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681042697"><a href="#local-6989586621681042697"><span class="hs-identifier">notExcluded</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-91"></a><span>      </span><a href="#local-6989586621681042697"><span class="hs-identifier hs-var">notExcluded</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-comment">-- | Calling @excludeDocTests tests toExclude@ returns all test suites from</span><span>
</span><a name="line-94"></a><span class="hs-comment">-- @tests@ which are not present in @toExclude@.</span><span>
</span><a name="line-95"></a><span class="hs-identifier">excludeDocTests</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span class="hs-special">]</span><span>
</span><a name="line-96"></a><a name="excludeDocTests"><a href="Michelson.Doc.Test.html#excludeDocTests"><span class="hs-identifier">excludeDocTests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="Michelson.Doc.Test.html#excludeDocTest"><span class="hs-identifier hs-var">excludeDocTest</span></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- | Finalize test suites.</span><span>
</span><a name="line-99"></a><span class="hs-identifier">runDocTests</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Michelson.Doc.html#ContractDoc"><span class="hs-identifier hs-type">ContractDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TestTree</span><span class="hs-special">]</span><span>
</span><a name="line-100"></a><a name="runDocTests"><a href="Michelson.Doc.Test.html#runDocTests"><span class="hs-identifier">runDocTests</span></a></a><span> </span><a name="local-6989586621681042698"><a href="#local-6989586621681042698"><span class="hs-identifier">tests</span></a></a><span> </span><a name="local-6989586621681042699"><a href="#local-6989586621681042699"><span class="hs-identifier">contract</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-101"></a><span>  </span><a href="#local-6989586621681042698"><span class="hs-identifier hs-var">tests</span></a><span> </span><span class="hs-operator hs-var">&lt;&amp;&gt;</span><span> </span><span class="hs-glyph">\</span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-var">DocTest</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-identifier hs-var">testCase</span><span> </span><a href="#local-6989586621681042701"><span class="hs-identifier hs-var">dtDesc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681042702"><span class="hs-identifier hs-var">dtSuite</span></a><span> </span><a href="#local-6989586621681042699"><span class="hs-identifier hs-var">contract</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">-- | Ensure that 'DocTest' check fires on given contract.</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- Used in tests on this module.</span><span>
</span><a name="line-106"></a><span class="hs-identifier">expectDocTestFailure</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Michelson.Doc.html#ContractDoc"><span class="hs-identifier hs-type">ContractDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Assertion</span><span>
</span><a name="line-107"></a><a name="expectDocTestFailure"><a href="Michelson.Doc.Test.html#expectDocTestFailure"><span class="hs-identifier">expectDocTestFailure</span></a></a><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-var">DocTest</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621681042706"><a href="#local-6989586621681042706"><span class="hs-identifier">contract</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-108"></a><span>  </span><a name="local-6989586621681042707"><a href="#local-6989586621681042707"><span class="hs-identifier">passed</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681042705"><span class="hs-identifier hs-var">dtSuite</span></a><span> </span><a href="#local-6989586621681042706"><span class="hs-identifier hs-var">contract</span></a><span> </span><span class="hs-operator hs-var">$&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">catch</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier hs-var">HUnitFailure</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-109"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621681042707"><span class="hs-identifier hs-var">passed</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">assertFailure</span><span> </span><span class="hs-string">&quot;Test didn't fail unexpectedly&quot;</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- Test predicates</span><span>
</span><a name="line-113"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">-- Utilities</span><span>
</span><a name="line-116"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-comment">-- | Apply given function to each group (created with 'DocGroup' instruction)</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- recursively.</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- This function will accept grouping doc item itself and its subcontents.</span><span>
</span><a name="line-121"></a><span class="hs-identifier">forEachLayer</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Doc.html#DocBlock"><span class="hs-identifier hs-type">DocBlock</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Michelson.Doc.html#SomeDocItem"><span class="hs-identifier hs-type">SomeDocItem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Michelson.Doc.html#DocBlock"><span class="hs-identifier hs-type">DocBlock</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681042690"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681042690"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">]</span><span>
</span><a name="line-122"></a><a name="forEachLayer"><a href="Michelson.Doc.Test.html#forEachLayer"><span class="hs-identifier">forEachLayer</span></a></a><span> </span><a name="local-6989586621681042708"><a href="#local-6989586621681042708"><span class="hs-identifier">block</span></a></a><span> </span><a name="local-6989586621681042709"><a href="#local-6989586621681042709"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-123"></a><span>  </span><a href="Michelson.Doc.html#DocSection"><span class="hs-identifier hs-var">DocSection</span></a><span> </span><a name="local-6989586621681042710"><a href="#local-6989586621681042710"><span class="hs-identifier">docElems</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621681042708"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-124"></a><span>  </span><a href="Michelson.Doc.html#DocElem"><span class="hs-identifier hs-var">DocElem</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621681042710"><span class="hs-identifier hs-var">docElems</span></a><span>
</span><a name="line-125"></a><span>  </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Michelson.Doc.html#SubDoc"><span class="hs-identifier hs-var">SubDoc</span></a><span> </span><a name="local-6989586621681042713"><a href="#local-6989586621681042713"><span class="hs-identifier">sub</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621681042712"><span class="hs-identifier hs-var">deSub</span></a><span>
</span><a name="line-126"></a><span>  </span><a href="#local-6989586621681042709"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="Michelson.Doc.html#SomeDocItem"><span class="hs-identifier hs-var">SomeDocItem</span></a><span> </span><a href="#local-6989586621681042711"><span class="hs-identifier hs-var">deItem</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681042713"><span class="hs-identifier hs-var">sub</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Michelson.Doc.Test.html#forEachLayer"><span class="hs-identifier hs-var">forEachLayer</span></a><span> </span><a href="#local-6989586621681042713"><span class="hs-identifier hs-var">sub</span></a><span> </span><a href="#local-6989586621681042709"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">-- | Apply given function to each group (created with 'DocGroup' instruction)</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- within a contract recursively.</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- This function will accept grouping doc item itself (unless we are at root)</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- and its subcontents.</span><span>
</span><a name="line-132"></a><span class="hs-identifier">forEachContractLayer</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Doc.html#ContractDoc"><span class="hs-identifier hs-type">ContractDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Michelson.Doc.html#SomeDocItem"><span class="hs-identifier hs-type">SomeDocItem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Michelson.Doc.html#DocBlock"><span class="hs-identifier hs-type">DocBlock</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681042689"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681042689"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">]</span><span>
</span><a name="line-133"></a><a name="forEachContractLayer"><a href="Michelson.Doc.Test.html#forEachContractLayer"><span class="hs-identifier">forEachContractLayer</span></a></a><span> </span><a name="local-6989586621681042714"><a href="#local-6989586621681042714"><span class="hs-identifier">contract</span></a></a><span> </span><a name="local-6989586621681042715"><a href="#local-6989586621681042715"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-134"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681042716"><a href="#local-6989586621681042716"><span class="hs-identifier">contents</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cdContents</span><span> </span><a href="#local-6989586621681042714"><span class="hs-identifier hs-var">contract</span></a><span>
</span><a name="line-135"></a><span>  </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621681042715"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621681042716"><span class="hs-identifier hs-var">contents</span></a><span>
</span><a name="line-136"></a><span>   </span><span class="hs-glyph">:</span><span> </span><a href="Michelson.Doc.Test.html#forEachLayer"><span class="hs-identifier hs-var">forEachLayer</span></a><span> </span><a href="#local-6989586621681042716"><span class="hs-identifier hs-var">contents</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621681042717"><a href="#local-6989586621681042717"><span class="hs-identifier">sdi</span></a></a><span> </span><a name="local-6989586621681042718"><a href="#local-6989586621681042718"><span class="hs-identifier">blk</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681042715"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681042717"><span class="hs-identifier hs-var">sdi</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681042718"><span class="hs-identifier hs-var">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- | Apply given function to each doc item within a contract.</span><span>
</span><a name="line-139"></a><span class="hs-identifier">forEachContractDocItem</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Doc.html#DocItem"><span class="hs-identifier hs-type">DocItem</span></a><span> </span><a href="#local-6989586621681042687"><span class="hs-identifier hs-type">d</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Michelson.Doc.html#ContractDoc"><span class="hs-identifier hs-type">ContractDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681042687"><span class="hs-identifier hs-type">d</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681042688"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681042688"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">]</span><span>
</span><a name="line-140"></a><a name="forEachContractDocItem"><a href="Michelson.Doc.Test.html#forEachContractDocItem"><span class="hs-identifier">forEachContractDocItem</span></a></a><span> </span><a name="local-6989586621681042719"><a href="#local-6989586621681042719"><span class="hs-identifier">contract</span></a></a><span> </span><a name="local-6989586621681042720"><a href="#local-6989586621681042720"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-identifier hs-var">fold</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Michelson.Doc.Test.html#forEachContractLayer"><span class="hs-identifier hs-var">forEachContractLayer</span></a><span> </span><a href="#local-6989586621681042719"><span class="hs-identifier hs-var">contract</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681042721"><a href="#local-6989586621681042721"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621681042720"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Michelson.Doc.html#lookupDocBlockSection"><span class="hs-identifier hs-var">lookupDocBlockSection</span></a><span> </span><a href="#local-6989586621681042721"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">-- Basic predicates</span><span>
</span><a name="line-145"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-comment">-- | Check that contract documentation is wrapped with 'contractName'.</span><span>
</span><a name="line-148"></a><span class="hs-identifier">testContractNameAtTop</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span>
</span><a name="line-149"></a><a name="testContractNameAtTop"><a href="Michelson.Doc.Test.html#testContractNameAtTop"><span class="hs-identifier">testContractNameAtTop</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-150"></a><span>  </span><a href="Michelson.Doc.Test.html#mkDocTest"><span class="hs-identifier hs-var">mkDocTest</span></a><span> </span><span class="hs-string">&quot;The whole contract is wrapped into 'DName'&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-151"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621681042722"><a href="#local-6989586621681042722"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-152"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681042723"><a href="#local-6989586621681042723"><span class="hs-identifier">mSections</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Michelson.Doc.html#lookupDocBlockSection"><span class="hs-identifier hs-var">lookupDocBlockSection</span></a><span> </span><span class="hs-glyph">@</span><a href="Michelson.Doc.html#DName"><span class="hs-identifier hs-type">DName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">cdContents</span><span> </span><a href="#local-6989586621681042722"><span class="hs-identifier hs-var">contractDoc</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681042723"><span class="hs-identifier hs-var">mSections</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-154"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">assertFailure</span><span> </span><span class="hs-string">&quot;There is no 'DName' at the top&quot;</span><span>
</span><a name="line-155"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">-- | Check that contracts themselves do not set the git revision. It is supposed to be filled only</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- in the executable.</span><span>
</span><a name="line-159"></a><span class="hs-identifier">testNoGitInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span>
</span><a name="line-160"></a><a name="testNoGitInfo"><a href="Michelson.Doc.Test.html#testNoGitInfo"><span class="hs-identifier">testNoGitInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-161"></a><span>  </span><a href="Michelson.Doc.Test.html#mkDocTest"><span class="hs-identifier hs-var">mkDocTest</span></a><span> </span><span class="hs-string">&quot;Git revision is not set in the contract&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-162"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621681042724"><a href="#local-6989586621681042724"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-163"></a><span>    </span><a name="local-6989586621681042725"><a href="#local-6989586621681042725"><span class="hs-identifier">assertions</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Michelson.Doc.Test.html#forEachContractDocItem"><span class="hs-identifier hs-var">forEachContractDocItem</span></a><span> </span><a href="#local-6989586621681042724"><span class="hs-identifier hs-var">contractDoc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-164"></a><span>      </span><a href="Michelson.Doc.html#DGitRevisionUnknown"><span class="hs-identifier hs-var">DGitRevisionUnknown</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">assertFailure</span><span> </span><span class="hs-string">&quot;Unexpected Git revision&quot;</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-identifier hs-var">assertBool</span><span> </span><span class="hs-string">&quot;No Git revision placeholder found or more than one&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-167"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621681042725"><span class="hs-identifier hs-var">assertions</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span class="hs-comment">-- | Check that there is at least one non-grouping doc item.</span><span>
</span><a name="line-170"></a><span class="hs-comment">--</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- If there is no such, rendered documentation will be empty which signals about</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- most of the documentation pieces being lost.</span><span>
</span><a name="line-173"></a><span class="hs-identifier">testDocNotEmpty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span>
</span><a name="line-174"></a><a name="testDocNotEmpty"><a href="Michelson.Doc.Test.html#testDocNotEmpty"><span class="hs-identifier">testDocNotEmpty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-175"></a><span>  </span><a href="Michelson.Doc.Test.html#mkDocTest"><span class="hs-identifier hs-var">mkDocTest</span></a><span> </span><span class="hs-string">&quot;There is at least one DOC_ITEM&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-176"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621681042730"><a href="#local-6989586621681042730"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-177"></a><span>    </span><span class="hs-identifier hs-var">assertBool</span><span> </span><span class="hs-string">&quot;No doc items found&quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">or</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-178"></a><span>      </span><a href="Michelson.Doc.Test.html#forEachContractLayer"><span class="hs-identifier hs-var">forEachContractLayer</span></a><span> </span><a href="#local-6989586621681042730"><span class="hs-identifier hs-var">contractDoc</span></a><span> </span><a href="#local-6989586621681042726"><span class="hs-identifier hs-var">hasDocItem</span></a><span>
</span><a name="line-179"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-180"></a><span>    </span><a name="local-6989586621681042726"><a href="#local-6989586621681042726"><span class="hs-identifier">hasDocItem</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681042727"><a href="#local-6989586621681042727"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-181"></a><span>      </span><a href="Michelson.Doc.html#DocSection"><span class="hs-identifier hs-var">DocSection</span></a><span> </span><a name="local-6989586621681042728"><a href="#local-6989586621681042728"><span class="hs-identifier">docElems</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621681042727"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-182"></a><span>      </span><a name="local-6989586621681042729"><a href="#local-6989586621681042729"><span class="hs-identifier">docElem</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621681042728"><span class="hs-identifier hs-var">docElems</span></a><span>
</span><a name="line-183"></a><span>      </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="Michelson.Doc.html#deIsAtomic"><span class="hs-identifier hs-var">deIsAtomic</span></a><span> </span><a href="#local-6989586621681042729"><span class="hs-identifier hs-var">docElem</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-comment">-- | Check that no group contains two 'DDescription' items.</span><span>
</span><a name="line-186"></a><span class="hs-comment">--</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- Normally such behaviour is allowed and can be exploited, but often it is not</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- and multiple descriptions appearence under the same group signals about</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- missing grouping wrapper (e.g. use of 'caseT' instead of 'entryCase').</span><span>
</span><a name="line-190"></a><span class="hs-identifier">testNoAdjacentDescriptions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span>
</span><a name="line-191"></a><a name="testNoAdjacentDescriptions"><a href="Michelson.Doc.Test.html#testNoAdjacentDescriptions"><span class="hs-identifier">testNoAdjacentDescriptions</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-192"></a><span>  </span><a href="Michelson.Doc.Test.html#mkDocTest"><span class="hs-identifier hs-var">mkDocTest</span></a><span> </span><span class="hs-string">&quot;No two 'DDescription' appear under the same group&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-193"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621681042733"><a href="#local-6989586621681042733"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-194"></a><span>    </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Michelson.Doc.Test.html#forEachContractLayer"><span class="hs-identifier hs-var">forEachContractLayer</span></a><span> </span><a href="#local-6989586621681042733"><span class="hs-identifier hs-var">contractDoc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681042734"><a href="#local-6989586621681042734"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-195"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="Michelson.Doc.html#lookupDocBlockSection"><span class="hs-identifier hs-var">lookupDocBlockSection</span></a><span> </span><span class="hs-glyph">@</span><a href="Michelson.Doc.html#DDescription"><span class="hs-identifier hs-type">DDescription</span></a><span> </span><a href="#local-6989586621681042734"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-196"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681042735"><a href="#local-6989586621681042735"><span class="hs-identifier">ds</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-operator hs-var">:|</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-197"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681042736"><a href="#local-6989586621681042736"><span class="hs-identifier">txts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681042735"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-operator hs-var">&lt;&amp;&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Michelson.Doc.html#DDescription"><span class="hs-identifier hs-var">DDescription</span></a><span> </span><a name="local-6989586621681042737"><a href="#local-6989586621681042737"><span class="hs-identifier">txt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681042737"><span class="hs-identifier hs-var">txt</span></a><span>
</span><a name="line-198"></a><span>          </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">assertFailure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmt</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-199"></a><span>             </span><span class="hs-identifier hs-var">nameF</span><span> </span><span class="hs-string">&quot;Found multiple adjacent descriptions&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-200"></a><span>             </span><span class="hs-identifier hs-var">blockListF</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621681042731"><span class="hs-identifier hs-var">quotes</span></a><span> </span><a href="#local-6989586621681042736"><span class="hs-identifier hs-var">txts</span></a><span>
</span><a name="line-201"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pass</span><span>
</span><a name="line-202"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-203"></a><span>      </span><a name="local-6989586621681042731"><a href="#local-6989586621681042731"><span class="hs-identifier">quotes</span></a></a><span> </span><a name="local-6989586621681042732"><a href="#local-6989586621681042732"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621681042732"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-comment">-- | Check that all descriptions are proper.</span><span>
</span><a name="line-206"></a><span class="hs-identifier">testDescriptionsAreWellFormatted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span>
</span><a name="line-207"></a><a name="testDescriptionsAreWellFormatted"><a href="Michelson.Doc.Test.html#testDescriptionsAreWellFormatted"><span class="hs-identifier">testDescriptionsAreWellFormatted</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-208"></a><span>  </span><a href="Michelson.Doc.Test.html#mkDocTest"><span class="hs-identifier hs-var">mkDocTest</span></a><span> </span><span class="hs-string">&quot;Descriptions are well-formatted&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-209"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621681042740"><a href="#local-6989586621681042740"><span class="hs-identifier">contractDoc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Michelson.Doc.Test.html#forEachContractDocItem"><span class="hs-identifier hs-var">forEachContractDocItem</span></a><span> </span><a href="#local-6989586621681042740"><span class="hs-identifier hs-var">contractDoc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Michelson.Doc.html#DDescription"><span class="hs-identifier hs-var">DDescription</span></a><span> </span><a name="local-6989586621681042741"><a href="#local-6989586621681042741"><span class="hs-identifier">desc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-211"></a><span>      </span><a href="#local-6989586621681042738"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toText</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toLazyText</span><span> </span><a href="#local-6989586621681042741"><span class="hs-identifier hs-var">desc</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-213"></a><span>    </span><a name="local-6989586621681042738"><a href="#local-6989586621681042738"><span class="hs-identifier">check</span></a></a><span> </span><a name="local-6989586621681042739"><a href="#local-6989586621681042739"><span class="hs-identifier">desc</span></a></a><span>
</span><a name="line-214"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">T.null</span><span> </span><a href="#local-6989586621681042739"><span class="hs-identifier hs-var">desc</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-215"></a><span>          </span><span class="hs-identifier hs-var">assertFailure</span><span> </span><span class="hs-string">&quot;Empty description.&quot;</span><span>
</span><a name="line-216"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">T.last</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.stripEnd</span><span> </span><a href="#local-6989586621681042739"><span class="hs-identifier hs-var">desc</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">'.'</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-217"></a><span>          </span><span class="hs-identifier hs-var">assertFailure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Description does not end with a dot:\n\&quot;&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span>
</span><a name="line-218"></a><span>                          </span><span class="hs-identifier hs-var">toString</span><span> </span><a href="#local-6989586621681042739"><span class="hs-identifier hs-var">desc</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span>
</span><a name="line-219"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pass</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">-- | Base properties which should comply for all documentations.</span><span>
</span><a name="line-222"></a><span class="hs-identifier">testDocBasic</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Michelson.Doc.Test.html#DocTest"><span class="hs-identifier hs-type">DocTest</span></a><span class="hs-special">]</span><span>
</span><a name="line-223"></a><a name="testDocBasic"><a href="Michelson.Doc.Test.html#testDocBasic"><span class="hs-identifier">testDocBasic</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-224"></a><span>  </span><span class="hs-special">[</span><span> </span><a href="Michelson.Doc.Test.html#testContractNameAtTop"><span class="hs-identifier hs-var">testContractNameAtTop</span></a><span>
</span><a name="line-225"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#testNoGitInfo"><span class="hs-identifier hs-var">testNoGitInfo</span></a><span>
</span><a name="line-226"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#testDocNotEmpty"><span class="hs-identifier hs-var">testDocNotEmpty</span></a><span>
</span><a name="line-227"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#testNoAdjacentDescriptions"><span class="hs-identifier hs-var">testNoAdjacentDescriptions</span></a><span>
</span><a name="line-228"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Michelson.Doc.Test.html#testDescriptionsAreWellFormatted"><span class="hs-identifier hs-var">testDescriptionsAreWellFormatted</span></a><span>
</span><a name="line-229"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-230"></a></pre></body></html>